import{_ as R,u as P,y as B,o as r,c as i,l as u,A as L,j as W,O as T,P as I,b as A,B as y,a as s,r as m,g as V,x as C,C as b,F,I as N,f as $,Q as z,R as O,d as E,S as j,J as q,m as a,n as M,D as U,z as D}from"./index-CEK05V9V.js";import{g as S,W as Q}from"./WiNavbar-BZupQX3X.js";import{W as G}from"./WISpinner-DN0cYtBI.js";import{C as J}from"./vue-content-loader.es-CyId24bj.js";const Y="/wisher/assets/ozon-DIAmpGYW.png",Z="/wisher/assets/wb-_uZB1mgy.png",H="/wisher/assets/ym-I_fhSRkn.png",K="/wisher/assets/reserved-DQT6e_Tb.png",X={__name:"WiBackButton",setup(v){const o=P();function l(){o.go(-1)}return(_,c)=>{const e=B("font-awesome-icon");return r(),i("button",{class:"back__button",onClick:l},[u(e,{icon:["fas","arrow-left-long"],class:"back__icon"})])}}},ee=R(X,[["__scopeId","data-v-d8b0ce73"]]),se={__name:"WiContextMenu",setup(v){const o=L({visible:!1});function l(){o.visible=!1}function _(c){c.target.closest(".context__menu__container")||l()}return W(()=>{window.addEventListener("mousedown",_)}),T(()=>{window.removeEventListener("mousedown",_)}),(c,e)=>(r(),i("div",{class:"context__menu__container",onClick:e[1]||(e[1]=k=>o.visible=!o.visible)},[I(c.$slots,"default",{},void 0),o.visible?(r(),i("div",{key:0,class:"context__menu",onClick:e[0]||(e[0]=A(()=>{},["stop"]))},[I(c.$slots,"menu",{hideMenu:l},void 0)])):y("",!0)]))}},te=R(se,[["__scopeId","data-v-e8657dbf"]]),ae=["open"],oe={class:"modal__dialog__inner"},re={class:"modal__content"},ne={__name:"WiModal",props:{modelValue:{type:Boolean,required:!0}},setup(v){return(o,l)=>(r(),i("dialog",{class:"modal__dialog",open:v.modelValue},[s("div",oe,[s("div",re,[I(o.$slots,"default",{},void 0)])])],8,ae))}},ie=R(ne,[["__scopeId","data-v-4274a8ef"]]),ce={class:"card__menu__list"},le=["onClick"],_e=["onClick"],de={class:"menu__modal__content"},ue={class:"menu__modal__buttons"},me={__name:"WiCardMenu",props:{card:{type:Object,default:()=>{}}},emits:["toggle-fulfill"],setup(v,{emit:o}){const l=v,_=o,c=m(null),e=P(),k=N(),p=m(!1),w=V();function d(){const f=!l.card.fulfilled;_("toggleFulfill",f)}async function t(){try{const f=$(w,"wishes",c.value);await z(f),console.log(`карточка id: ${c.value} удалена.`)}catch(f){console.error("Ошибка при удалении карточки",f)}e.go(-1)}return W(()=>{c.value=k.params.uid}),(f,n)=>{const g=B("font-awesome-icon");return r(),i(F,null,[u(te,null,{menu:C(({hideMenu:h})=>[s("ul",ce,[s("li",{class:"card__menu__item card__menu__item--fulfilled",onClick:x=>[h(),d()]},[u(g,{class:"menu__icon",icon:["fas","check"]}),n[2]||(n[2]=b(" Исполнено "))],8,le),s("li",{class:"card__menu__item card__menu__item--delete",onClick:x=>[h(),p.value=!0]},[u(g,{class:"menu__icon",icon:["fas","trash-can"]}),n[3]||(n[3]=b(" Удалить "))],8,_e)])]),default:C(()=>[u(g,{class:"card__menu--icon",icon:["fas","ellipsis-vertical"]})]),_:1}),u(ie,{modelValue:p.value,"onUpdate:modelValue":n[1]||(n[1]=h=>p.value=h)},{default:C(()=>[s("div",de,[n[4]||(n[4]=s("h3",{class:"menu__modal--confirm"}," Удалить карточку? ",-1)),n[5]||(n[5]=s("span",{class:"menu__modal--remind"},"Восстановить её будет невозможно.",-1)),s("div",ue,[s("button",{class:"menu__modal__button menu__modal__button--decline",onClick:n[0]||(n[0]=h=>p.value=!1)}," нет, я передумал "),s("button",{class:"menu__modal__button menu__modal__button--accept",onClick:t}," да, удалить ")])])]),_:1},8,["modelValue"])],64)}}},fe=R(me,[["__scopeId","data-v-cd51cf68"]]),ve=O("card",()=>{const v=m({}),o=m(null),l=m({}),_=m({}),c=m(!0),e=m(!0),k=m(!1),p=m(""),w=m(!1),d=V(),t=E();return j(t,n=>{n?o.value=n:o.value=null}),{isLoading:c,currentUser:o,isReserved:w,reservedBy:p,user:v,blockSelfReserve:e,reservedUser:l,hasEditPermission:k,card:_,getCardData:async n=>{try{c.value=!0;const g=await q($(d,"wishes",n)),h=g.exists()?g.data():null;if(h){_.value=h,p.value=_.value.reserve||"",w.value=!!_.value.reserve;const x=await S(_.value.userId);v.value=x.user,o.value?e.value=o.value.uid!==_.value.userId:e.value=!0}if(_.value.reserve){const x=await S(_.value.reserve);l.value=x.user,o.value&&o.value.uid===l.value.uid&&(k.value=!0)}}catch(g){console.log(g,"wicardstore")}finally{c.value=!1}}}}),pe={key:0,class:"card"},ge={key:1},he={class:"card__user__info"},ke={class:"card__user__wrapper"},we={class:"card__img-wrapper--avatar"},ye=["src"],be={key:0,class:"card__user__link-title"},Ce=["href"],xe={key:1},$e={key:0,class:"card__menu"},Re={class:"card__wrapper"},Ue={class:"card__images"},Be={class:"card__description"},De={class:"card__img__wrapper--description"},Ie=["src"],Se={class:"card__links"},We={class:"card__links-wrapper"},Ve={class:"card__links--item"},Me=["href"],Pe={class:"card__links--item"},Fe=["href"],Ne={class:"card__links--item"},Ee=["href"],Le={class:"card__description__info"},Te={class:"card__description__user"},Ae={class:"user__title"},ze={class:"user__description"},Oe={key:1,class:"card__description--actions"},je={key:0,class:"card__description--reserved"},qe={class:"card__reserved__text"},Qe={key:1,class:"card__description--reserved"},Ge={key:1,class:"card__reserved__text"},Je={key:2},Ye={class:"card__status card__status--fulfilled"},Ze={key:3,class:"card__reserved__text"},He={__name:"CardDetailsPageView",setup(v){const o=V(),l=E(),_=N(),c=m(!1),e=ve(),{getCardData:k}=e;async function p(d){try{const t=$(o,"wishes",e.card.id);await D(t,{fulfilled:d}),e.card.fulfilled=d}catch(t){console.error("Ошибка при изменении статуса fulfilled",t)}}async function w(){e.hasEditPermission=!0;try{c.value=!0;const d=l.currentUser,t=await S(d.uid);e.isReserved&&e.reservedBy===d.uid?(await D($(o,"wishes",e.card.id),{reserve:""}),e.reservedBy="",e.isReserved=!1,e.reservedUser={}):e.isReserved||(await D($(o,"wishes",e.card.id),{reserve:l.currentUser.uid}),e.reservedBy=d.uid,e.isReserved=!0,e.reservedUser=t.user)}catch(d){console.log(d,"Ошибка при резерве карточки")}finally{c.value=!1}}return W(async()=>{try{await k(_.params.uid)}catch(d){console.error("не удалось загрузить данные карточки:",d)}}),(d,t)=>{const f=B("router-link"),n=B("font-awesome-icon");return r(),i(F,null,[u(Q),a(e)?(r(),i("div",pe,[u(ee,{class:"card__back__button"}),a(e).isLoading?(r(),M(a(J),{key:0,viewBox:"0 0 1000 700",speed:2,"primary-color":"#f5f7fa","secondary-color":"#f0f0f0"},{default:C(()=>t[0]||(t[0]=[s("rect",{x:"0",y:"0",rx:"10",ry:"10",width:"1000",height:"700"},null,-1)])),_:1})):(r(),i("div",ge,[s("div",he,[s("div",ke,[s("div",we,[s("img",{class:"card__image card__image--user",src:a(e).user.photoUrl,alt:""},null,8,ye)]),u(f,{to:{name:"UserProfile",params:{uid:a(e).user.uid}},class:"card__user-name"},{default:C(()=>[b(U(a(e).user.displayName),1)]),_:1},8,["to"]),a(e).card.link?(r(),i("span",be,[t[1]||(t[1]=b(" поделился ссылкой ")),s("a",{href:a(e).card.link,target:"_blank",rel:"noopener noreferrer"},[u(n,{icon:["fas","up-right-from-square"]})],8,Ce)])):(r(),i("span",xe,"не указал ссылку"))]),a(e).blockSelfReserve?y("",!0):(r(),i("div",$e,[u(fe,{card:a(e).card,onToggleFulfill:p},null,8,["card"])]))]),s("div",Re,[s("div",Ue,[s("div",Be,[s("div",De,[s("img",{class:"card__image card__image--description",src:a(e).card.img,alt:""},null,8,Ie)])]),s("div",Se,[t[5]||(t[5]=s("h3",{class:"card__links__title"}," Найти на маркетплейсах ",-1)),s("div",We,[s("div",Ve,[s("a",{href:`https://www.ozon.ru/search/?from_global=true&text=${encodeURIComponent(a(e).card.name)}`,target:"_blank"},t[2]||(t[2]=[s("img",{class:"card__image card__links--img",src:Y,alt:""},null,-1)]),8,Me)]),s("div",Pe,[s("a",{href:`https://www.wildberries.ru/catalog/0/search.aspx?search=${encodeURIComponent(a(e).card.name)}`,target:"_blank"},t[3]||(t[3]=[s("img",{class:"card__image card__links--img",src:Z,alt:""},null,-1)]),8,Fe)]),s("div",Ne,[s("a",{href:`https://market.yandex.ru/search?text=${encodeURIComponent(a(e).card.name)}`,target:"_blank"},t[4]||(t[4]=[s("img",{class:"card__image card__links--img",src:H,alt:""},null,-1)]),8,Ee)])])])]),s("div",Le,[s("div",Te,[s("h1",Ae,U(a(e).card.name),1),s("span",ze,U(a(e).card.description),1)]),c.value?(r(),M(G,{key:0,class:"card__spinner"})):(r(),i("div",Oe,[a(e).isReserved?(r(),i("div",je,[a(e).hasEditPermission?(r(),i("button",{key:0,class:"card__button card__button-free",onClick:w}," отказаться ")):y("",!0),t[7]||(t[7]=s("div",null,[s("img",{class:"card__description--stamp",src:K,alt:""})],-1)),s("span",qe,[t[6]||(t[6]=b("Зарезервировано пользователем ")),u(f,{to:{name:"UserProfile",params:{uid:a(e).reservedUser.uid}},class:"card__user-name"},{default:C(()=>[b(U(a(e).reservedUser.displayName),1)]),_:1},8,["to"])])])):!a(e).isReserved&&a(l).currentUser&&!a(e).card.fulfilled?(r(),i("div",Qe,[a(e).blockSelfReserve?(r(),i("button",{key:0,class:"card__button card__button-reserved",onClick:w}," зарезервировать ")):y("",!0),a(e).blockSelfReserve?(r(),i("span",Ge,"Pарезервируйте этот подарок, если хотите его подарить.")):y("",!0)])):a(e).card.fulfilled?(r(),i("div",Je,[s("div",Ye,[t[8]||(t[8]=b(" Исполнено ")),u(n,{icon:["fas","check"],class:"card__status--icon"})])])):a(l).currentUser?y("",!0):(r(),i("div",Ze,t[9]||(t[9]=[s("span",null,"Для бронирования желаний нужно зарегистрироваться",-1)])))]))])])]))])):y("",!0)],64)}}},ts=R(He,[["__scopeId","data-v-1de59247"]]);export{ts as default};

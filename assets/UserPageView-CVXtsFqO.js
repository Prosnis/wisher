import{g as H,u as J,W as O}from"./WiNavbar-BZupQX3X.js";import{_ as w,r as _,o as t,c,a as s,q as S,I as P,d as N,g as F,j as V,f as E,J as G,D as W,z as j,H as Q,C as A,B as g,l as C,m as u,n as m,F as L,u as I,p as U,y as q,x as b,t as B,K as X,L as Y}from"./index-CEK05V9V.js";import{g as Z,r as ee,u as se,a as te}from"./index.esm2017-Df_A5IJQ.js";import{_ as R}from"./empty-nqOw6-D2.js";import{W as K,g as re}from"./GetAllWishes-CMV4OY_h.js";import{u as T}from"./WiProfileStore-BtBEn_0G.js";import{C as x}from"./vue-content-loader.es-CyId24bj.js";const oe={class:"profile__nav"},ae={__name:"WiProfileNavbar",emits:["changeView"],setup(d,{emit:i}){const o=i,e=_("WiUserWishesVue");function l(a){e.value=a,o("changeView",a)}return(a,r)=>(t(),c("div",oe,[s("button",{class:S(["nav__button",{active:e.value==="WiUserWishesVue"}]),onClick:r[0]||(r[0]=n=>l("WiUserWishesVue"))}," Мой вишлист ",2),s("button",{class:S(["nav__button",{active:e.value==="SubscribeListView"}]),onClick:r[1]||(r[1]=n=>l("SubscribeListView"))}," Мои подписки ",2),s("button",{class:S(["nav__button",{active:e.value==="WiReservedListView"}]),onClick:r[2]||(r[2]=n=>l("WiReservedListView"))}," Зарезервированные подарки ",2)]))}},ie=w(ae,[["__scopeId","data-v-46ae3f9e"]]),le={__name:"WiSubscribeButton",setup(d){const i=P(),o=N(),e=F(),l=_([]),a=_(null),r=_(!1);async function n(){const y=E(e,"users",a.value.uid);try{await j(y,{subscribe:l.value})}catch(v){console.error("err",v)}}function f(){const y=l.value.findIndex(v=>v===i.params.uid);y!==-1?(l.value.splice(y,1),r.value=!1,console.log("otpiska")):(l.value.push(i.params.uid),r.value=!0,console.log("podpisan")),n()}return V(async()=>{if(o.currentUser){a.value=o.currentUser;const y=E(e,"users",a.value.uid);try{const v=await G(y);if(v.exists()){const D=v.data();l.value=D.subscribe||[],r.value=l.value.includes(i.params.uid)}}catch(v){console.error("err",v)}}}),(y,v)=>(t(),c("button",{class:"button__subscribe",onClick:f},[s("span",{class:S([r.value?"unsubscribe__title":"subscribe__title"])},W(r.value?"Вы подписаны":"Подписаться"),3)]))}},ne=F(),ue=Z(),ce=N();async function z(d,i){const o=ee(ue,i);return await se(o,d),await te(o)}async function pe(d,i,o,e){e.value=!0;const l=ce.currentUser,a=E(ne,"users",l.uid),r={};try{if(o.value){const n=await z(o.value,`avatars/${l.uid}`);r.photoUrl=n,d.photoUrl=n}if(i.value){const n=await z(i.value,`wallpapers/${l.uid}`);r.wallpaperUrl=n,d.wallpaperUrl=n}return await j(a,r),console.log("Профиль успешно обновлен"),{avatarUrl:r.photoUrl,wallpaperUrl:r.wallpaperUrl}}catch(n){console.log("ошибка при загрузке профиля,",n)}finally{e.value=!1}}const _e=["src"],de={key:0,for:"input-wallaper",class:"profile__wallaper-edit"},fe={class:"profile__user__Info"},ve={key:0,class:"profile__spinner"},me=["src"],ye={key:1,for:"input-avatar",class:"profile__photo profile__photo--edit"},he={class:"profile__name"},ge={class:"profile__about"},we={__name:"WiUserPagePicturesEdit",props:{user:{type:Object,default:()=>({})},hasEditPermission:{type:Boolean},userName:{type:String},userAbout:{type:String}},setup(d){const i=d,o=_(!1),e=_(!1),l=_(null),a=_(null),r=_(!1),n=_(!1),f=P(),y=I(),v=N();function D(){const $=f.params.uid;y.push({path:`${U.settings}/${$}`})}function M($,p){const k=p.target.files[0];$==="avatar"?a.value=k:$==="wallpaper"&&(l.value=k),pe(i.user,l,a,r)}return($,p)=>{const k=q("font-awesome-icon");return t(),c(L,null,[s("div",{class:"profile__wallapper",onMouseenter:p[2]||(p[2]=h=>o.value=!0),onMouseleave:p[3]||(p[3]=h=>o.value=!1)},[s("img",{src:i.user.wallpaperUrl,alt:"user-wallpaper",loading:"lazy",class:"profile__wallapper-img",style:Q({opacity:n.value?1:0}),onLoad:p[0]||(p[0]=h=>n.value=!0)},null,44,_e),o.value&&d.hasEditPermission?(t(),c("label",de,[s("input",{id:"input-wallaper",class:"profile__input profile__input--wallpaper",type:"file",onChange:p[1]||(p[1]=h=>M("wallpaper",h))},null,32),p[7]||(p[7]=A(" изменить обложку "))])):g("",!0)],32),s("div",fe,[s("div",{class:"profile__photo-wrapper",onMouseenter:p[5]||(p[5]=h=>e.value=!0),onMouseleave:p[6]||(p[6]=h=>e.value=!1)},[r.value?(t(),c("div",ve)):g("",!0),s("img",{class:"profile__photo",src:i.user.photoUrl,alt:"user-photo",loading:"lazy"},null,8,me),e.value&&i.hasEditPermission?(t(),c("label",ye,[s("input",{id:"input-avatar",class:"profile__input profile__input--avatar",type:"file",onChange:p[4]||(p[4]=h=>M("avatar",h))},null,32),C(k,{class:"profile__icon profile__icon-edit",icon:["fas","edit"]})])):g("",!0),s("div",null,[s("h2",he,W(i.user.displayName),1),s("p",ge,W(i.user.about||"Информация о пользователе отсутствует"),1)])],32),i.hasEditPermission?(t(),c("button",{key:0,class:"profile_setting_button",onClick:D},[C(k,{icon:["fas","gear"]}),p[8]||(p[8]=A("редактировать профиль "))])):g("",!0),!i.hasEditPermission&&u(v).currentUser&&u(v).currentUser.uid!==u(f).params.uid?(t(),m(le,{key:1})):g("",!0)])],64)}}},be=w(we,[["__scopeId","data-v-dbe83322"]]),$e={key:1},ke={class:"wishes__list"},Ue={key:0,class:"wishes__buttons"},xe={class:"whishes__cards"},We={key:1,class:"empty"},Ce={__name:"WiUserWishes",setup(d){const i=P(),o=I(),e=T(),{getProfileData:l}=e,a=_(!1);return V(async()=>{try{a.value=!0,await l(i.params.uid)}catch(r){console.log(r)}finally{a.value=!1}}),(r,n)=>a.value?(t(),m(u(x),{key:0,class:"skeleton__wishes",viewBox:"0 0 1300 400",speed:2,"primary-color":"#f5f7fa","secondary-color":"#f0f0f0"},{default:b(()=>n[3]||(n[3]=[s("rect",{x:"0",y:"0",rx:"10",ry:"10",width:"1300",height:"400"},null,-1)])),_:1})):(t(),c("div",$e,[s("section",ke,[u(e).hasEditPermission?(t(),c("div",Ue,[s("button",{class:"wishes__button",onClick:n[0]||(n[0]=()=>u(o).push(u(U).cardAdd))}," Добавить желание "),s("button",{class:"wishes__button",onClick:n[1]||(n[1]=()=>u(o).push(u(U).invitationCard))}," Создать приглашение "),s("button",{class:"wishes__button",onClick:n[2]||(n[2]=()=>u(o).push(u(U).cards))}," Желания пользователей ")])):g("",!0),s("div",xe,[(t(!0),c(L,null,B(u(e).wishes,f=>(t(),m(K,{key:f.id,wish:f,"user-img":u(e).user.photoUrl,"user-name":u(e).user.displayName},null,8,["wish","user-img","user-name"]))),128))]),u(e).wishes.length===0?(t(),c("div",We,n[4]||(n[4]=[s("img",{class:"empty__image",src:R,alt:""},null,-1),s("span",null,"Здесь пока пусто...",-1)]))):g("",!0)])]))}},Pe=w(Ce,[["__scopeId","data-v-550118df"]]),Ve={class:"users__wrapper"},Le={class:"users__items"},Se=["onClick"],Be={class:"mini__profile__wallpaper"},De=["src"],Ee={class:"mini__profile__avatar"},Ne=["src"],Ie={class:"mini__profile__info"},Re={class:"mini__profile--title"},Me={__name:"WiMiniProfileCard",props:{users:{type:Array,required:!0}},setup(d){const i=d,o=I();async function e(l){try{await o.push(`${U.user}/${l}`),window.location.reload()}catch(a){console.log(a)}}return(l,a)=>(t(),c("div",Ve,[s("div",Le,[(t(!0),c(L,null,B(i.users,r=>(t(),c("div",{key:r.uid,class:"mini__profile",onClick:n=>e(r.uid)},[s("div",Be,[s("img",{class:"profile__img profile__img--wallpaper",src:r.wallpaperUrl,alt:""},null,8,De)]),s("div",Ee,[s("img",{class:"profile__img profile__img--avatar",src:r.photoUrl,alt:""},null,8,Ne)]),s("div",Ie,[s("h3",Re,W(r.displayName),1),a[0]||(a[0]=s("span",{class:"mini__profile--description"},"открыть профиль",-1))])],8,Se))),128))])]))}},Ae=w(Me,[["__scopeId","data-v-cecd0acd"]]),ze=_(new Map);async function Fe(d){try{return(await Promise.all(d.map(async o=>{try{const{user:e}=await H(o);return ze.value.set(o,e),e}catch(e){return console.error(`Error fetching data for ${o}:`,e),null}}))).filter(o=>o!==null)}catch(i){return console.error("Error fetching all data:",i),[]}}const je={key:1,class:"subs"},qe={key:2,class:"empty"},Ke={__name:"SubscribeListView",setup(d){const i=J(),o=_([]),e=_(!1);return V(async()=>{try{e.value=!0,o.value=await Fe(i.user.subscribe)}catch(l){console.log(l)}finally{e.value=!1}}),(l,a)=>e.value?(t(),m(u(x),{key:0,viewBox:"0 0 1300 260",speed:2,"primary-color":"#f5f7fa","secondary-color":"#f0f0f0"},{default:b(()=>a[0]||(a[0]=[s("rect",{x:"0",y:"0",rx:"10",ry:"10",width:"1300",height:"260"},null,-1)])),_:1})):o.value.length>0&&!e.value?(t(),c("div",je,[C(Ae,{users:o.value},null,8,["users"])])):(t(),c("div",qe,a[1]||(a[1]=[s("img",{class:"empty__image",src:R,alt:"empty__image"},null,-1),s("span",null,"Здесь пока пусто...",-1)])))}},Te=w(Ke,[["__scopeId","data-v-e3ac0029"]]),He={key:1,class:"reserved"},Je={key:2,class:"empty"},Oe={__name:"WiReservedListView",setup(d){const i=P(),o=_([]),e=_([]),l=_(!1);return V(async()=>{try{l.value=!0,o.value=await re(),e.value=o.value.filter(a=>a.reserve===i.params.uid)}catch(a){console.log(a)}finally{l.value=!1}}),(a,r)=>{const n=q("ContentLoader");return t(),c("div",null,[l.value?(t(),m(n,{key:0,viewBox:"0 0 1300 360",speed:2,"primary-color":"#f5f7fa","secondary-color":"#f0f0f0"},{default:b(()=>r[0]||(r[0]=[s("rect",{x:"0",y:"0",rx:"10",ry:"10",width:"1300",height:"360"},null,-1)])),_:1})):e.value.length>0&&!l.value?(t(),c("div",He,[(t(!0),c(L,null,B(e.value,f=>(t(),m(K,{key:f.id,wish:f},null,8,["wish"]))),128))])):(t(),c("div",Je,r[1]||(r[1]=[s("img",{class:"empty__image",src:R,alt:""},null,-1),s("span",null,"Здесь пока пусто...",-1)])))])}}},Ge=w(Oe,[["__scopeId","data-v-b10542d4"]]),Qe={class:"user"},Xe={key:1,class:"user__info"},Ye={class:"profile"},Ze={key:3,class:"profile__badges"},es={key:5,class:"profile__nav"},ss={class:"profile__wishes__wrapper"},ts={class:"wishes"},rs={__name:"UserPageView",setup(d){const i=P(),o={WiUserWishesVue:Pe,WiReservedListView:Ge,SubscribeListView:Te},e=T(),{getProfileData:l}=e,a=_("WiUserWishesVue");function r(n){a.value=n}return V(async()=>{await l(i.params.uid)}),(n,f)=>(t(),c("div",null,[s("div",null,[C(O)]),s("main",Qe,[u(e).skeletonLoad?(t(),m(u(x),{key:0,viewBox:"0 0 1300 365",speed:2,"primary-color":"#f5f7fa","secondary-color":"#f0f0f0"},{default:b(()=>f[0]||(f[0]=[s("rect",{x:"0",y:"0",rx:"10",ry:"10",width:"1300",height:"345"},null,-1)])),_:1})):(t(),c("section",Xe,[s("div",Ye,[C(be,{user:u(e).user,"has-edit-permission":u(e).hasEditPermission,"user-name":u(e).user.displayName,"user-about":u(e).user.about},null,8,["user","has-edit-permission","user-name","user-about"])])])),u(e).skeletonLoad?(t(),m(u(x),{key:2,class:"skeleton",viewBox:"0 0 1300 67",speed:2,"primary-color":"#f5f7fa","secondary-color":"#f0f0f0"},{default:b(()=>f[1]||(f[1]=[s("rect",{x:"0",y:"0",rx:"10",ry:"10",width:"1300",height:"67"},null,-1)])),_:1})):(t(),c("div",Ze,[(t(!0),c(L,null,B(u(e).badges,(y,v)=>(t(),c("div",{key:v,class:"badge"},W(y.name),1))),128))])),u(e).skeletonLoad?(t(),m(u(x),{key:4,class:"skeleton",viewBox:"0 0 1300 75",speed:2,"primary-color":"#f5f7fa","secondary-color":"#f0f0f0"},{default:b(()=>f[2]||(f[2]=[s("rect",{x:"0",y:"0",rx:"10",ry:"10",width:"1300",height:"75"},null,-1)])),_:1})):(t(),c("div",es,[u(e).hasEditPermission?(t(),m(ie,{key:0,onChangeView:r})):g("",!0)])),s("div",ss,[s("div",ts,[(t(),m(Y,null,[(t(),m(X(o[a.value])))],1024))])])])]))}},ps=w(rs,[["__scopeId","data-v-db5e89bf"]]);export{ps as default};

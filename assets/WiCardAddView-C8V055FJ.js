import{_ as Q,g as K,d as Z,r as u,A as G,c as f,l as B,a as s,C as X,w as b,v as y,b as D,q as P,n as T,x as V,m as F,F as A,t as ee,D as U,B as j,o as n,H as se,u as te,e as ae,f as re,y as oe,p as ne}from"./index-CEK05V9V.js";import{W as ie}from"./WiNavbar-BZupQX3X.js";import{b as le}from"./UserBadgesStore-wYMTvAUU.js";import{u as ce}from"./WiProfileStore-BtBEn_0G.js";import{C as $}from"./vue-content-loader.es-CyId24bj.js";const de="/wisher/assets/box-C3QgpmQ8.jpg",H=["Искусство","Музыка","Танцы","Спорт","Кулинария","Путешествия","Чтение","Садоводство","Рукоделие","Игры","Фотография","Коллекционирование","Технологии","Писательство","Фитнес и здоровье","Рыбалка и охота","Автомобили и мотоциклы","Наука","Моделирование","Саморазвитие","Животные и природа","Экстрим","Мода и стиль","Кино и сериалы","Активный отдых","Электроника","Интерьер и уют","Косметология"],ue="Bearer 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",N=10;async function fe(h){try{const d=[];for(let o=0;o<H.length;o+=N){const _=H.slice(o,o+N),i=await fetch("https://api-inference.huggingface.co/models/facebook/bart-large-mnli",{method:"POST",headers:{"Content-Type":"application/json",Authorization:ue},body:JSON.stringify({inputs:h,parameters:{candidate_labels:_}})});if(!i.ok){const l=await i.text();throw new Error(`Ошибка HTTP ${i.status}: ${l}`)}const p=await i.json(),m=p.labels.map((l,g)=>({label:l,score:p.scores[g]}));d.push(...m.sort((l,g)=>g.score-l.score).slice(0,3))}return d}catch(d){return console.error("Ошибка при запросе:",d.message),[]}}async function _e(h){const d="http://212.22.90.119:3000/fetch-product";try{const o=await fetch(d,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:h})});if(!o.ok)throw new Error(`Ошибка HTTP: ${o.status}`);const _=await o.json();return console.log("Данные о товаре:",_),_}catch(o){console.error("Ошибка:",o.message)}}const pe={class:"container"},me={class:"parser"},ge=["disabled"],ve=["disabled"],be={class:"form__list"},ye={class:"form__list__item"},he={class:"form__list__item"},ke={class:"form__list__item"},xe={class:"form__list__item"},we={class:"form__badge__item"},Ce={key:0,class:"form__badge__wrapper"},Te=["onClick"],Ue={key:1,class:"form__badge__spinner"},Se={key:3,class:"form__preview"},Be={class:"form__preview__card"},De={class:"card__label card__label--file",for:"file-input"},Pe=["src"],Ve={class:"card__title"},Fe={__name:"WiCardAddView",setup(h){const d=te(),o=K(),_=Z(),i=u(!1),p=u(""),m=u(!0),l=u(!1),g=u("Заполнить вручную"),w=u("Ожидаем название.."),k=u(!1),v=u([]),O=ce(),{addWish:z}=O;function E(){m.value=!m.value,g.value=m.value?"Заполнить вручную":"Создать из ссылки"}const t=G({img:"",name:"",description:"",price:"",date:new Date().toLocaleDateString(),link:"",badge:[]});async function I(){try{k.value=!0,i.value=!0;const a=p.value,e=await _e(a);t.img=e.image,t.name=e.title,t.description=e.description,t.link=e.link,t.price=e.price,E(),l.value=!1,S(t.name)}catch(a){console.log("parseFromYandex",a),l.value=!0}finally{k.value=!1,i.value=!1}}function L(){Object.assign(t,{img:"",name:"",description:"",price:"",date:"",link:""})}function W(a){return{id:crypto.randomUUID(),userId:_.currentUser.uid,img:a.img||de,name:a.name,hover:!1,description:a.description||"Описание отсутствует. ",price:a.price||0,date:a.date||new Date().toLocaleDateString(),link:a.link,reserve:"",badge:a.badge,fulfilled:!1}}function Y(){d.push(`${ne.user}/${_.currentUser.uid}`)}async function q(){const a=W(t);console.log("123");try{await ae(re(o,"wishes",a.id),a),z(a),L(),Y()}catch(e){console.log(e,"Ошибка при создании карточки")}}function M(a){const e=a.target.files[0];if(e){const c=new FileReader;c.onload=r=>{t.img=r.target.result},c.readAsDataURL(e)}}function C(a){return t.badge.some(e=>e.name===a.name)}function R(a){const e=t.badge.findIndex(c=>c.name===a.name);t.badge.length&&e||(e!==-1?t.badge.splice(e,1):t.badge.push(a))}let x=!1;async function S(a){if(!x){if(x=!0,!(t!=null&&t.name)||t.name.trim()===""){console.error("form.name is undefined or empty"),x=!1;return}try{w.value="Подбираем категорию..",v.value=[],console.log("Before classifyText:",a);const e=await fe(a);console.log("After classifyText:",e),v.value=le.filter(c=>e.some(r=>c.name.includes(r.label)))}catch(e){console.error("Error in classifiedHobbies:",e),v.value=[]}finally{w.value="Выберите подходящую категорию:",x=!1}}}return(a,e)=>{const c=oe("font-awesome-icon");return n(),f(A,null,[B(ie),s("div",pe,[s("div",me,[e[7]||(e[7]=s("span",{class:"parser__title"},[X("Найти товар на "),s("a",{href:"https://market.yandex.ru/",target:"_blank",class:"parser__title--link"},"Яндекс Маркет")],-1)),b(s("input",{id:"link","onUpdate:modelValue":e[0]||(e[0]=r=>p.value=r),class:"parser__input",type:"text",maxlength:"200",required:""},null,512),[[y,p.value]]),s("button",{class:"parser__button",onClick:D(I,["prevent","stop"])}," Создать желание по ссылке "),s("span",{class:P([l.value?"parser__error":"parser__error--visible"])},"Произошла ошибка. Пожалуйста, проверьте ссылку или заполните форму вручную.",2)]),s("form",{onSubmit:D(q,["prevent"])},[s("fieldset",{disabled:k.value,class:"form fieldset"},[i.value?(n(),T(F($),{key:0,class:"form__preview",viewBox:"0 0 430 540",speed:2,"primary-color":"#f5f7fa","secondary-color":"#f0f0f0"},{default:V(()=>e[8]||(e[8]=[s("rect",{x:"0",y:"0",rx:"10",ry:"10",width:"430",height:"540"},null,-1)])),_:1})):(n(),f("div",{key:1,class:"form__input__group",disabled:k.value},[s("ul",be,[s("li",ye,[e[9]||(e[9]=s("label",{class:"form__label",for:"name"},"Название:",-1)),b(s("input",{id:"name","onUpdate:modelValue":e[1]||(e[1]=r=>t.name=r),class:"form__input",type:"text",required:"",maxlength:"80",onChange:e[2]||(e[2]=r=>S(t.name))},null,544),[[y,t.name]])]),s("li",he,[e[10]||(e[10]=s("label",{class:"form__label",for:"description"},"Описание",-1)),b(s("textarea",{id:"description","onUpdate:modelValue":e[3]||(e[3]=r=>t.description=r),class:"form__textarea",type:"text",maxlength:"100"},null,512),[[y,t.description]])]),s("li",ke,[e[11]||(e[11]=s("label",{class:"form__label",for:"price"},"Цена",-1)),b(s("input",{id:"price","onUpdate:modelValue":e[4]||(e[4]=r=>t.price=r),class:"form__input",type:"number",maxlength:"100",oninput:"this.value = this.value.slice(0, 10)"},null,512),[[y,t.price]])]),s("li",xe,[e[12]||(e[12]=s("label",{class:"form__label",for:"link"},"Ссылка на товар",-1)),b(s("input",{id:"link","onUpdate:modelValue":e[5]||(e[5]=r=>t.link=r),class:"form__input",type:"text",maxlength:"200"},null,512),[[y,t.link]])]),s("li",we,[s("div",null,[v.value.length>0?(n(),f("div",Ce,[(n(!0),f(A,null,ee(v.value,(r,J)=>(n(),f("div",{key:J,class:P([C(r)?"form__badge__picked":"form__badge"]),style:se({backgroundColor:C(r)?"#0817ecb9":"#f5f7fa",color:C(r)?"#f0f0f0":"#0817ecb9"}),onClick:Ae=>R(r)},U(r.name),15,Te))),128))])):(n(),f("div",Ue,[s("span",null,U(w.value),1),B(c,{class:"badge__icon--loading",icon:["fas","circle-notch"],spin:""})]))])])])],8,ve)),i.value?(n(),T(F($),{key:2,class:"form__preview",viewBox:"0 0 430 540",speed:2,"primary-color":"#f5f7fa","secondary-color":"#f0f0f0"},{default:V(()=>e[13]||(e[13]=[s("rect",{x:"0",y:"0",rx:"10",ry:"10",width:"430",height:"540"},null,-1)])),_:1})):(n(),f("div",Se,[s("div",Be,[s("label",De,[t.img?(n(),f("img",{key:0,src:t.img,alt:"",class:"card__image"},null,8,Pe)):j("",!0),t.img?j("",!0):(n(),T(c,{key:1,class:"card__icon--file",icon:["fas","file-image"]})),s("input",{id:"file-input",class:"card__input card__input--file",type:"file",onChange:e[6]||(e[6]=r=>M(r))},null,32)]),s("h3",Ve,U(t.name),1)]),e[14]||(e[14]=s("button",{class:"form__button--add"}," добавить ",-1))]))],8,ge)],32)])],64)}}},ze=Q(Fe,[["__scopeId","data-v-550df877"]]);export{ze as default};

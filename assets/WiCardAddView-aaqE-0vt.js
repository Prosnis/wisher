import{_ as R,g as W,f as Y,r as p,y as $,c as l,d as D,a as t,b as x,t as C,z as b,A as S,w as v,v as k,F as V,m as H,B as M,o as a,E as q,u as J,s as Q,h as K,q as Z,p as G}from"./index-B2m54ijR.js";import{W as X}from"./WiNavbar-qMcUzFTC.js";import{b as ee}from"./UserBadgesStore-jHlPkzW9.js";import{u as te}from"./WiProfileStore--A81iFL3.js";import"./GetUserData-jCM42mLR.js";const re="/wisher/assets/box-C3QgpmQ8.jpg",B=["Искусство","Музыка","Танцы","Спорт","Кулинария","Путешествия","Чтение","Садоводство","Рукоделие","Игры","Фотография","Коллекционирование","Технологии","Писательство","Фитнес и здоровье","Рыбалка и охота","Автомобили и мотоциклы","Наука","Моделирование","Саморазвитие","Животные и природа","Экстрим","Мода и стиль","Кино и сериалы","Активный отдых","Электроника","Видеоблогинг","Косметология"],F=10;async function oe(h){try{const i=[];for(let n=0;n<B.length;n+=F){const c=B.slice(n,n+F),u=await fetch("https://api-inference.huggingface.co/models/MoritzLaurer/bge-m3-zeroshot-v2.0",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer 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"},body:JSON.stringify({inputs:h,parameters:{candidate_labels:c}})});if(!u.ok)throw new Error(`Ошибка HTTP: ${u.status}`);const f=await u.json(),{labels:d,scores:w}=f,_=d.map((g,y)=>({label:g,score:w[y]})).sort((g,y)=>y.score-g.score);i.push(..._.slice(0,2))}return console.log("Результаты классификации:",i),i}catch(i){console.error("Ошибка при запросе:",i.message)}}async function se(h){const i="http://212.22.90.119:3000/fetch-product";try{const n=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:h})});if(!n.ok)throw new Error(`Ошибка HTTP: ${n.status}`);const c=await n.json();return console.log("Данные о товаре:",c),c}catch(n){console.error("Ошибка:",n.message)}}const ne={key:0,class:"form__create--byLink profile__spinner"},ae={key:1,class:"form__create--byLink"},ie={key:0},le={key:2,class:"form__wrapper"},ce={class:"form__list"},ue={class:"form__preview__card"},de={class:"card__label card__label--file",for:"file-input"},me=["src"],pe={class:"card__title"},fe={class:"card__price"},_e={key:3,class:"form__btn form__btn--add"},ge={__name:"WiCardAddView",setup(h){const i=J(),n=W(),c=Y(),u=p(!1),f=p(""),d=p(!0),w=p(!1),T=p("Заполнить вручную"),_=p([]),g=te(),{addWish:y}=g;function U(){d.value=!d.value,T.value=d.value?"Заполнить вручную":"Создать из ссылки"}const r=$({img:"",name:"",description:"",price:"",date:new Date().toLocaleDateString(),link:""});async function L(){try{u.value=!0;const o=f.value,e=await se(o);r.img=e.image,r.name=e.title,r.description=e.description,r.link=e.link,r.price=e.price,U()}catch(o){console.log("parseFromYandex",o),w.value=!0}finally{u.value=!1}}function P(o){return o?new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB",minimumFractionDigits:0}).format(o):""}function N(){Object.assign(r,{img:"",name:"",description:"",price:"",date:"",link:""})}function j(o){return{id:crypto.randomUUID(),userId:c.currentUser.uid,img:o.img||re,name:o.name,hover:!1,description:o.description||"Описание отсутствует. ",price:o.price||0,date:o.date||new Date().toLocaleDateString(),link:o.link,reserve:""}}function z(){i.push(`${G.user}/${c.currentUser.uid}`)}async function A(){const o=j(r);try{await Q(K(n,"wishes",o.id),o),y(o),N(),z()}catch(e){console.log(e,"Ошибка при создании карточки")}}function O(o){const e=o.target.files[0];if(e){const m=new FileReader;m.onload=s=>{r.img=s.target.result},m.readAsDataURL(e)}}async function E(o){try{const e=await oe(o);_.value=ee.filter(m=>e.some(s=>m.name.includes(s.label)))}catch(e){console.error(e),_.value=[]}}return(o,e)=>{const m=Z("font-awesome-icon");return a(),l(V,null,[D(X),t("form",{class:"form",onSubmit:x(A,["prevent"])},[e[14]||(e[14]=t("h1",{class:"form__title"}," Добавить желание ",-1)),t("button",{class:"form__btn form__btn--toggle",onClick:x(U,["prevent","stop"])},C(T.value),1),u.value?(a(),l("div",ne)):b("",!0),d.value?(a(),l("div",ae,[e[9]||(e[9]=t("h2",{class:"form__create__tittle"},[S(" Используйте ссылку на товар в "),t("span",{class:"form__create__span"},[t("a",{class:"form__span--link",target:"_blank",href:"https://market.yandex.ru/"}," Яндекс Маркет")])],-1)),v(t("input",{id:"link","onUpdate:modelValue":e[0]||(e[0]=s=>f.value=s),class:"form__input--byLink",type:"text",maxlength:"200",required:""},null,512),[[k,f.value]]),t("button",{class:"form__btn form__btn--byLink",onClick:x(L,["prevent","stop"])},[e[7]||(e[7]=S(" Найти товар ")),D(m,{class:"form__icon form__icon--byLink",icon:["fas","arrow-right"]})]),w.value?(a(),l("span",ie,[e[8]||(e[8]=S("К сожалению, произошла ошибка. Пожалуйста, проверьте ссылку или заполните карточку ")),t("ins",{class:"form__create__error",onClick:x(U,["prevent","stop"])},"вручную")])):b("",!0)])):(a(),l("div",le,[t("ul",ce,[t("li",null,[e[10]||(e[10]=t("label",{class:"form__label",for:"name"},"Название:",-1)),v(t("input",{id:"name","onUpdate:modelValue":e[1]||(e[1]=s=>r.name=s),class:"form__input",type:"text",required:"",maxlength:"30",onChange:e[2]||(e[2]=s=>E(r.name))},null,544),[[k,r.name]])]),t("li",null,[e[11]||(e[11]=t("label",{class:"form__label",for:"description"},"Описание",-1)),v(t("textarea",{id:"description","onUpdate:modelValue":e[3]||(e[3]=s=>r.description=s),class:"form__textarea",type:"text",maxlength:"100"},null,512),[[k,r.description]])]),t("li",null,[e[12]||(e[12]=t("label",{class:"form__label",for:"price"},"Цена",-1)),v(t("input",{id:"price","onUpdate:modelValue":e[4]||(e[4]=s=>r.price=s),class:"form__input",type:"number",maxlength:"100",oninput:"this.value = this.value.slice(0, 10)"},null,512),[[k,r.price]])]),t("li",null,[e[13]||(e[13]=t("label",{class:"form__label",for:"link"},"Ссылка на товар",-1)),v(t("input",{id:"link","onUpdate:modelValue":e[5]||(e[5]=s=>r.link=s),class:"form__input",type:"text",maxlength:"200"},null,512),[[k,r.link]])]),(a(!0),l(V,null,H(_.value,(s,I)=>(a(),l("div",{key:I,class:"form__badge",style:q({backgroundColor:s.BgColor,color:s.color})},C(s.name),5))),128))]),t("div",ue,[t("label",de,[r.img?(a(),l("img",{key:0,src:r.img,alt:"",class:"card__image"},null,8,me)):b("",!0),r.img?b("",!0):(a(),M(m,{key:1,class:"card__icon--file",icon:["fas","file-image"]})),t("input",{id:"file-input",class:"card__input card__input--file",type:"file",onChange:e[6]||(e[6]=s=>O(s))},null,32)]),t("h3",pe,C(r.name),1),t("p",fe,C(P(r.price)),1)])])),d.value?b("",!0):(a(),l("button",_e," добавить "))],32)],64)}}},we=R(ge,[["__scopeId","data-v-1103ce7d"]]);export{we as default};

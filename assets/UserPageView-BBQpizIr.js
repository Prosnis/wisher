import{u as q,g as G,W as H}from"./WiNavbar-nKao627v.js";import{_ as U,r as f,o as t,c,a as e,C as S,H as W,f as N,g as M,l as V,h as B,I as J,t as C,x as A,E as O,A as F,z as k,d as E,n as l,B as w,F as P,u as R,p as $,q as Q,G as L,m as I,b as X,J as Y,K as Z}from"./index-CIa3Xx9T.js";import{g as ee,r as se,u as te,a as oe}from"./index.esm2017-XUYcyQWm.js";import{W as K,g as ae}from"./GetAllWishes-DT5Oivib.js";import{u as j}from"./WiProfileStore-D3VDznkh.js";import{C as D}from"./vue-content-loader.es-BZWtuUsv.js";const re={class:"profile__nav"},ie={__name:"WiProfileNavbar",emits:["changeView"],setup(m,{emit:n}){const u=n,s=f("WiUserWishesVue");function i(r){s.value=r,u("changeView",r)}return(r,o)=>(t(),c("div",re,[e("button",{class:S(["nav__button",{active:s.value==="WiUserWishesVue"}]),onClick:o[0]||(o[0]=a=>i("WiUserWishesVue"))}," Мой вишлист ",2),e("button",{class:S(["nav__button",{active:s.value==="SubscribeListView"}]),onClick:o[1]||(o[1]=a=>i("SubscribeListView"))}," Мои подписки ",2),e("button",{class:S(["nav__button",{active:s.value==="WiReservedListView"}]),onClick:o[2]||(o[2]=a=>i("WiReservedListView"))}," Зарезервированные подарки ",2)]))}},ne=U(ie,[["__scopeId","data-v-46ae3f9e"]]),le={__name:"WiSubscribeButton",setup(m){const n=W(),u=N(),s=M(),i=f([]),r=f(null),o=f(!1);async function a(){const b=B(s,"users",r.value.uid);try{await A(b,{subscribe:i.value})}catch(_){console.error("err",_)}}function v(){const b=i.value.findIndex(_=>_===n.params.uid);b!==-1?(i.value.splice(b,1),o.value=!1,console.log("otpiska")):(i.value.push(n.params.uid),o.value=!0,console.log("podpisan")),a()}return V(async()=>{if(u.currentUser){r.value=u.currentUser;const b=B(s,"users",r.value.uid);try{const _=await J(b);if(_.exists()){const h=_.data();i.value=h.subscribe||[],o.value=i.value.includes(n.params.uid)}}catch(_){console.error("err",_)}}}),(b,_)=>(t(),c("button",{class:"button__subscribe",onClick:v},[e("span",{class:S([o.value?"unsubscribe__title":"subscribe__title"])},C(o.value?"Вы подписаны":"Подписаться"),3)]))}},ue=M(),ce=ee(),pe=N();async function T(m,n){const u=se(ce,n);return await te(u,m),await oe(u)}async function _e(m,n,u,s){s.value=!0;const i=pe.currentUser,r=B(ue,"users",i.uid),o={};try{if(u.value){const a=await T(u.value,`avatars/${i.uid}`);o.photoUrl=a,m.photoUrl=a}if(n.value){const a=await T(n.value,`wallpapers/${i.uid}`);o.wallpaperUrl=a,m.wallpaperUrl=a}return await A(r,o),console.log("Профиль успешно обновлен"),{avatarUrl:o.photoUrl,wallpaperUrl:o.wallpaperUrl}}catch(a){console.log("ошибка при загрузке профиля,",a)}finally{s.value=!1}}const de=["src"],ve={key:0,for:"input-wallaper",class:"profile__wallaper-edit"},fe={class:"profile__user__Info"},me={key:0,class:"profile__spinner"},be=["src"],he={key:1,for:"input-avatar",class:"profile__photo profile__photo--edit"},ye={class:"profile__name"},we={class:"profile__about"},ge={__name:"WiUserPagePicturesEdit",props:{user:{type:Object,default:()=>({})},hasEditPermission:{type:Boolean},userName:{type:String},userAbout:{type:String}},setup(m){const n=m,u=f(!1),s=f(!1),i=f(null),r=f(null),o=f(!1),a=f(!1),v=W(),b=R(),_=N();function h(){const y=v.params.uid;b.push({path:`${$.settings}/${y}`})}function d(y,p){const x=p.target.files[0];y==="avatar"?r.value=x:y==="wallpaper"&&(i.value=x),_e(n.user,i,r,o)}return(y,p)=>{const x=Q("font-awesome-icon");return t(),c(P,null,[e("div",{class:"profile__wallapper",onMouseenter:p[2]||(p[2]=g=>u.value=!0),onMouseleave:p[3]||(p[3]=g=>u.value=!1)},[e("img",{src:n.user.wallpaperUrl,alt:"user-wallpaper",loading:"lazy",class:"profile__wallapper-img",style:O({opacity:a.value?1:0}),onLoad:p[0]||(p[0]=g=>a.value=!0)},null,44,de),u.value&&m.hasEditPermission?(t(),c("label",ve,[e("input",{id:"input-wallaper",class:"profile__input profile__input--wallpaper",type:"file",onChange:p[1]||(p[1]=g=>d("wallpaper",g))},null,32),p[7]||(p[7]=F(" изменить обложку "))])):k("",!0)],32),e("div",fe,[e("div",{class:"profile__photo-wrapper",onMouseenter:p[5]||(p[5]=g=>s.value=!0),onMouseleave:p[6]||(p[6]=g=>s.value=!1)},[o.value?(t(),c("div",me)):k("",!0),e("img",{class:"profile__photo",src:n.user.photoUrl,alt:"user-photo",loading:"lazy"},null,8,be),s.value&&n.hasEditPermission?(t(),c("label",he,[e("input",{id:"input-avatar",class:"profile__input profile__input--avatar",type:"file",onChange:p[4]||(p[4]=g=>d("avatar",g))},null,32),E(x,{class:"profile__icon profile__icon-edit",icon:["fas","edit"]})])):k("",!0),e("div",null,[e("h2",ye,C(n.user.displayName),1),e("p",we,C(n.user.about||"Информация о пользователе отсутствует"),1)])],32),n.hasEditPermission?(t(),c("button",{key:0,class:"profile_setting_button",onClick:h},[E(x,{icon:["fas","gear"]}),p[8]||(p[8]=F("редактировать профиль "))])):k("",!0),!n.hasEditPermission&&l(_).currentUser&&l(_).currentUser.uid!==l(v).params.uid?(t(),w(le,{key:1})):k("",!0)])],64)}}},ke=U(ge,[["__scopeId","data-v-2d022028"]]),z="/wisher/assets/empty-BU5vWT-M.png",$e={key:1},Ue={class:"wishes__list"},We={key:0,class:"wishes__buttons"},xe={class:"whishes__cards"},Ce={key:1,class:"empty"},Ve={__name:"WiUserWishes",setup(m){const n=W(),u=R(),s=j(),{getProfileData:i}=s,r=f(!1);return N(),V(async()=>{try{r.value=!0,await i(n.params.uid)}catch(o){console.log(o)}finally{r.value=!1}}),(o,a)=>r.value?(t(),w(l(D),{key:0,class:"skeleton__wishes",viewBox:"0 0 1300 400",speed:2,"primary-color":"#f5f7fa","secondary-color":"#c9c5c5"},{default:L(()=>a[3]||(a[3]=[e("rect",{x:"0",y:"0",rx:"10",ry:"10",width:"1300",height:"400"},null,-1)])),_:1})):(t(),c("div",$e,[e("section",Ue,[l(s).hasEditPermission?(t(),c("div",We,[e("button",{class:"wishes__button",onClick:a[0]||(a[0]=()=>l(u).push(l($).cardAdd))}," Добавить желание "),e("button",{class:"wishes__button",onClick:a[1]||(a[1]=()=>l(u).push(l($).invitationCard))}," Создать приглашение "),e("button",{class:"wishes__button",onClick:a[2]||(a[2]=()=>l(u).push(l($).cards))}," Желания пользователей ")])):k("",!0),e("div",xe,[(t(!0),c(P,null,I(l(s).wishes,v=>(t(),w(K,{key:v.id,wish:v,"user-img":l(s).user.photoUrl,"user-name":l(s).user.displayName},null,8,["wish","user-img","user-name"]))),128))]),l(s).wishes.length===0?(t(),c("div",Ce,a[4]||(a[4]=[e("img",{class:"empty__image",src:z,alt:""},null,-1),e("span",null,"Здесь пока пусто...",-1)]))):k("",!0)])]))}},Pe=U(Ve,[["__scopeId","data-v-d66fb352"]]),Se={key:0,class:"subscribe__wrapper"},Le={class:"subscribe__list"},De=["onClick"],Be={class:"subscribe__item__wrapper"},Ee=["src"],Ne={class:"subscribe__item__title"},Re=["onClick"],Ie={key:1,class:"empty"},Me={__name:"SubscribeListView",setup(m){const n=W(),u=M(),s=q(),i=f(new Map),r=f([]),o=R();async function a(_){const h=await Promise.all(_.map(async d=>{if(i.value.has(d))return console.log("cached"),i.value.get(d);const{user:y}=await G(d);return i.value.set(d,y),console.log("new"),y}));r.value=h}async function v(_){try{await o.push(`${$.user}/${_}`),console.log(`${$.user}/${_}`),window.location.reload()}catch(h){console.log(h)}}async function b(_){const h=r.value.findIndex(d=>d.uid===_);if(h!==-1){r.value.splice(h,1);const d=r.value.map(p=>p.uid),y=B(u,"users",n.params.uid);try{await A(y,{subscribe:d})}catch(p){console.error("err",p)}}}return V(async()=>{await a(s.user.subscribe),console.log(r.value)}),(_,h)=>r.value.length>0?(t(),c("div",Se,[e("ul",Le,[(t(!0),c(P,null,I(r.value,d=>(t(),c("li",{key:d.uid,class:"subscribe__item",onClick:y=>v(d.uid)},[e("div",Be,[e("img",{class:"subscribe__item__avatar",src:d.photoUrl,alt:""},null,8,Ee),e("span",Ne,C(d.displayName),1)]),e("div",null,[e("button",{onClick:X(y=>b(d.uid),["stop"])}," otpiska ",8,Re)])],8,De))),128))])])):(t(),c("div",Ie,h[0]||(h[0]=[e("img",{class:"empty__image",src:z,alt:""},null,-1),e("span",null,"Здесь пока пусто...",-1)])))}},Ae=U(Me,[["__scopeId","data-v-dc9bba18"]]),ze={key:0,class:"reserved"},Fe={key:1,class:"empty"},Te={__name:"WiReservedListView",setup(m){const n=W(),u=f([]),s=f([]);return V(async()=>{u.value=await ae(),s.value=u.value.filter(i=>i.reserve===n.params.uid)}),(i,r)=>(t(),c("div",null,[s.value.length>0?(t(),c("div",ze,[(t(!0),c(P,null,I(s.value,o=>(t(),w(K,{key:o.id,wish:o},null,8,["wish"]))),128))])):(t(),c("div",Fe,r[0]||(r[0]=[e("img",{class:"empty__image",src:z,alt:""},null,-1),e("span",null,"Здесь пока пусто...",-1)])))]))}},Ke=U(Te,[["__scopeId","data-v-7f3b7f69"]]),je={class:"user"},qe={key:1,class:"user__info"},Ge={class:"profile"},He={key:3,class:"profile__badges test__profile"},Je={key:5,class:"profile__nav"},Oe={class:"profile__wishes__wrapper"},Qe={class:"wishes"},Xe={__name:"UserPageView",setup(m){R();const n=W(),u={WiUserWishesVue:Pe,WiReservedListView:Ke,SubscribeListView:Ae},s=j(),{getProfileData:i}=s,r=f("WiUserWishesVue");function o(a){r.value=a}return V(async()=>{await i(n.params.uid)}),(a,v)=>(t(),c("div",null,[e("div",null,[E(H)]),e("main",je,[l(s).skeletonLoad?(t(),w(l(D),{key:0,viewBox:"0 0 1300 365",speed:2,"primary-color":"#f5f7fa","secondary-color":"#c9c5c5"},{default:L(()=>v[0]||(v[0]=[e("rect",{x:"0",y:"0",rx:"10",ry:"10",width:"1300",height:"345"},null,-1)])),_:1})):(t(),c("section",qe,[e("div",Ge,[E(ke,{user:l(s).user,"has-edit-permission":l(s).hasEditPermission,"user-name":l(s).user.displayName,"user-about":l(s).user.about},null,8,["user","has-edit-permission","user-name","user-about"])])])),l(s).skeletonLoad?(t(),w(l(D),{key:2,class:"skeleton",viewBox:"0 0 1300 67",speed:2,"primary-color":"#f5f7fa","secondary-color":"#c9c5c5"},{default:L(()=>v[1]||(v[1]=[e("rect",{x:"0",y:"0",rx:"10",ry:"10",width:"1300",height:"67"},null,-1)])),_:1})):(t(),c("div",He,[(t(!0),c(P,null,I(l(s).badges,(b,_)=>(t(),c("div",{key:_,class:"badge"},C(b.name),1))),128))])),l(s).skeletonLoad?(t(),w(l(D),{key:4,class:"skeleton",viewBox:"0 0 1300 75",speed:2,"primary-color":"#f5f7fa","secondary-color":"#c9c5c5"},{default:L(()=>v[2]||(v[2]=[e("rect",{x:"0",y:"0",rx:"10",ry:"10",width:"1300",height:"75"},null,-1)])),_:1})):(t(),c("div",Je,[l(s).hasEditPermission?(t(),w(ne,{key:0,onChangeView:o})):k("",!0)])),e("div",Oe,[e("div",Qe,[(t(),w(Z,null,[(t(),w(Y(u[r.value])))],1024))])])])]))}},as=U(Xe,[["__scopeId","data-v-0ce5efb4"]]);export{as as default};

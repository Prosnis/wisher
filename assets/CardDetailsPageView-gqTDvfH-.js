import{_ as C,u as P,q as R,o as n,c as d,d as u,y as A,l as W,L as T,M as D,b as q,z as h,a as s,r as l,H as N,g as V,G as w,A as k,F as E,h as y,N as z,x as I,O as F,f as L,P as G,I as O,Q,n as o,B,t as x}from"./index-DV6QLsh7.js";import{g as S,W as H}from"./WiNavbar-BGj37Ed_.js";import{W as Y}from"./WISpinner-BgcdM9cj.js";import{C as Z}from"./vue-content-loader.es-BDU47Rbk.js";const j="/wisher/assets/ozon-DIAmpGYW.png",J="/wisher/assets/wb-_uZB1mgy.png",K="/wisher/assets/ym-I_fhSRkn.png",X="/wisher/assets/reserved-DQT6e_Tb.png",ee={__name:"WiBackButton",setup(f){const a=P();function c(){a.go(-1)}return(_,i)=>{const e=R("font-awesome-icon");return n(),d("button",{class:"back__button",onClick:c},[u(e,{icon:["fas","arrow-left-long"],class:"back__icon"})])}}},se=C(ee,[["__scopeId","data-v-d8b0ce73"]]),te={__name:"WiContextMenu",setup(f){const a=A({visible:!1});function c(){a.visible=!1}function _(i){i.target.closest(".context__menu__container")||c()}return W(()=>{window.addEventListener("mousedown",_)}),T(()=>{window.removeEventListener("mousedown",_)}),(i,e)=>(n(),d("div",{class:"context__menu__container",onClick:e[1]||(e[1]=p=>a.visible=!a.visible)},[D(i.$slots,"default",{},void 0),a.visible?(n(),d("div",{key:0,class:"context__menu",onClick:e[0]||(e[0]=q(()=>{},["stop"]))},[D(i.$slots,"menu",{hideMenu:c},void 0)])):h("",!0)]))}},ae=C(te,[["__scopeId","data-v-aed0bf5e"]]),re=["open"],oe={class:"modal__dialog__inner"},ne={class:"modal__content"},ie={__name:"WiModal",props:{modelValue:{type:Boolean,required:!0}},setup(f){return(a,c)=>(n(),d("dialog",{class:"modal__dialog",open:f.modelValue},[s("div",oe,[s("div",ne,[D(a.$slots,"default",{},void 0)])])],8,re))}},ce=C(ie,[["__scopeId","data-v-4274a8ef"]]),_e={class:"card__menu__list"},de=["onClick"],le=["onClick"],ue=["onClick"],me={class:"menu__modal__content"},ve={class:"menu__modal__buttons"},fe={__name:"WiCardMenu",setup(f){const a=l(null),c=P(),_=N(),i=l(!1),e=V();async function p(){try{const r=y(e,"wishes",a.value);await z(r),console.log(`карточка id: ${a.value} удалена.`)}catch(r){console.error("Ошибка при удалении карточки",r)}c.go(-1)}async function g(){try{const r=y(e,"wishes",a.value);await I(r,{fulfilled:!0}),console.log(`Карточка id: ${a.value} выполнена.`)}catch(r){console.error("Ошибка при обновлении статуса карточки",r)}}return W(()=>{a.value=_.params.uid}),(r,t)=>{const m=R("font-awesome-icon");return n(),d(E,null,[u(ae,null,{menu:w(({hideMenu:v})=>[s("ul",_e,[s("li",{class:"card__menu__item card__menu__item--edit",onClick:()=>v()},[u(m,{icon:["fas","pen"]}),t[2]||(t[2]=k(" Редактировать "))],8,de),s("li",{class:"card__menu__item card__menu__item--fulfilled",onClick:()=>[v(),g()]},[u(m,{icon:["fas","check-circle"]}),t[3]||(t[3]=k(" Исполнено "))],8,le),s("li",{class:"card__menu__item card__menu__item--delete",onClick:b=>[v(),i.value=!0]},[u(m,{icon:["fas","trash-can"]}),t[4]||(t[4]=k(" Удалить "))],8,ue)])]),default:w(()=>[u(m,{class:"card__menu--icon",icon:["fas","ellipsis-vertical"]})]),_:1}),u(ce,{modelValue:i.value,"onUpdate:modelValue":t[1]||(t[1]=v=>i.value=v)},{default:w(()=>[s("div",me,[t[5]||(t[5]=s("h3",{class:"menu__modal--confirm"}," Удалить карточку? ",-1)),t[6]||(t[6]=s("span",{class:"menu__modal--remind"},"Восстановить её будет невозможно.",-1)),s("div",ve,[s("button",{class:"menu__modal__button menu__modal__button--decline",onClick:t[0]||(t[0]=v=>i.value=!1)}," нет, я передумал "),s("button",{class:"menu__modal__button menu__modal__button--accept",onClick:p}," да, удалить ")])])]),_:1},8,["modelValue"])],64)}}},pe=C(fe,[["__scopeId","data-v-123b35dc"]]),ge=F("card",()=>{const f=l({}),a=l(null),c=l({}),_=l({}),i=l(!0),e=l(!0),p=l(!1),g=l(""),r=l(!1),t=V(),m=L();return G(m,b=>{b?a.value=b:a.value=null}),{isLoading:i,currentUser:a,isReserved:r,reservedBy:g,user:f,blockSelfReserve:e,reservedUser:c,hasEditPermission:p,card:_,getCardData:async b=>{try{i.value=!0;const $=await O(y(t,"wishes",b)),M=$.exists()?$.data():null;if(M){_.value=M,g.value=_.value.reserve||"",r.value=!!_.value.reserve;const U=await S(_.value.userId);f.value=U.user,a.value&&a.value.uid===_.value.userId&&(e.value=!1)}if(_.value.reserve){const U=await S(_.value.reserve);c.value=U.user,a.value&&a.value.uid===c.value.uid&&(p.value=!0)}}catch($){console.log($,"wicardstore")}finally{i.value=!1}}}}),ke={class:"card"},he={key:1},we={class:"card__user__info"},be={class:"card__user__wrapper"},ye={class:"card__img-wrapper--avatar"},Ce=["src"],$e={key:0,class:"card__user__link-title"},xe=["href"],Re={key:1},Ue={class:"card__menu"},Be={class:"card__wrapper"},De={class:"card__images"},Ie={class:"card__description"},Se={class:"card__img__wrapper--description"},We=["src"],Ve={class:"card__links"},Me={class:"card__links-wrapper"},Pe={class:"card__links--item"},Ne=["href"],Ee={class:"card__links--item"},Le=["href"],Ae={class:"card__links--item"},Te=["href"],qe={class:"card__description__info"},ze={class:"card__description__user"},Fe={class:"user__title"},Ge={class:"user__description"},Oe={key:1,class:"card__description--actions"},Qe={key:0,class:"card__description--reserved"},He={class:"card__reserved__text"},Ye={key:1,class:"card__description--reserved"},Ze={key:1,class:"card__reserved__text"},je={key:2,class:"card__reserved__text"},Je={__name:"CardDetailsPageView",setup(f){const a=V(),c=L(),_=N(),i=l(!1),e=ge(),{getCardData:p}=e;Q(e.card,r=>{r.reserve?(e.blockSelfReserve=e.currentUser.uid!==r.userId,console.log(e.blockSelfReserve=e.currentUser.uid!==r.userId)):e.blockSelfReserve=!0});async function g(){e.hasEditPermission=!0;try{i.value=!0;const r=c.currentUser,t=await S(r.uid);e.isReserved&&e.reservedBy===r.uid?(await I(y(a,"wishes",e.card.id),{reserve:""}),e.reservedBy="",e.isReserved=!1,e.reservedUser={}):e.isReserved||(await I(y(a,"wishes",e.card.id),{reserve:c.currentUser.uid}),e.reservedBy=r.uid,e.isReserved=!0,e.reservedUser=t.user)}catch(r){console.log(r,"Ошибка при резерве карточки")}finally{i.value=!1}}return W(async()=>{try{await p(_.params.uid)}catch(r){console.error("не удалось загрузить данные карточки:",r)}}),(r,t)=>{const m=R("router-link"),v=R("font-awesome-icon");return n(),d(E,null,[u(H),s("div",ke,[u(se,{class:"card__back__button"}),o(e).isLoading?(n(),B(o(Z),{key:0,viewBox:"0 0 1000 700",speed:2,"primary-color":"#f5f7fa","secondary-color":"#c9c5c5"},{default:w(()=>t[0]||(t[0]=[s("rect",{x:"0",y:"0",rx:"10",ry:"10",width:"1000",height:"700"},null,-1)])),_:1})):(n(),d("div",he,[s("div",we,[s("div",be,[s("div",ye,[s("img",{class:"card__image card__image--user",src:o(e).user.photoUrl,alt:""},null,8,Ce)]),u(m,{to:{name:"UserProfile",params:{uid:o(e).user.uid}},class:"card__user-name"},{default:w(()=>[k(x(o(e).user.displayName),1)]),_:1},8,["to"]),o(e).card.link?(n(),d("span",$e,[t[1]||(t[1]=k(" поделился ссылкой ")),s("a",{href:o(e).card.link,target:"_blank",rel:"noopener noreferrer"},[u(v,{icon:["fas","up-right-from-square"]})],8,xe)])):(n(),d("span",Re,"не указал ссылку"))]),s("div",Ue,[o(e).blockSelfReserve?h("",!0):(n(),B(pe,{key:0}))])]),s("div",Be,[s("div",De,[s("div",Ie,[s("div",Se,[s("img",{class:"card__image card__image--description",src:o(e).card.img,alt:""},null,8,We)])]),s("div",Ve,[t[5]||(t[5]=s("h3",{class:"card__links__title"}," Найти на маркетплейсах ",-1)),s("div",Me,[s("div",Pe,[s("a",{href:`https://www.ozon.ru/search/?from_global=true&text=${encodeURIComponent(o(e).card.name)}`,target:"_blank"},t[2]||(t[2]=[s("img",{class:"card__image card__links--img",src:j,alt:""},null,-1)]),8,Ne)]),s("div",Ee,[s("a",{href:`https://www.wildberries.ru/catalog/0/search.aspx?search=${encodeURIComponent(o(e).card.name)}`,target:"_blank"},t[3]||(t[3]=[s("img",{class:"card__image card__links--img",src:J,alt:""},null,-1)]),8,Le)]),s("div",Ae,[s("a",{href:`https://market.yandex.ru/search?text=${encodeURIComponent(o(e).card.name)}`,target:"_blank"},t[4]||(t[4]=[s("img",{class:"card__image card__links--img",src:K,alt:""},null,-1)]),8,Te)])])])]),s("div",qe,[s("div",ze,[s("h1",Fe,x(o(e).card.name),1),s("span",Ge,x(o(e).card.description),1)]),i.value?(n(),B(Y,{key:0,class:"card__spinner"})):(n(),d("div",Oe,[o(e).isReserved?(n(),d("div",Qe,[o(e).hasEditPermission?(n(),d("button",{key:0,class:"card__button card__button-free",onClick:g}," отказаться ")):h("",!0),t[7]||(t[7]=s("div",null,[s("img",{class:"card__description--stamp",src:X,alt:""})],-1)),s("span",He,[t[6]||(t[6]=k("Зарезервировано пользователем ")),u(m,{to:{name:"UserProfile",params:{uid:o(e).reservedUser.uid}},class:"card__user-name"},{default:w(()=>[k(x(o(e).reservedUser.displayName),1)]),_:1},8,["to"])])])):!o(e).isReserved&&o(c).currentUser&&!o(e).card.fulfilled?(n(),d("div",Ye,[o(e).blockSelfReserve?(n(),d("button",{key:0,class:"card__button card__button-reserved",onClick:g}," зарезервировать ")):h("",!0),o(e).blockSelfReserve?(n(),d("span",Ze,"Pарезервируйте этот подарок, если хотите его подарить.")):h("",!0)])):o(c).currentUser?h("",!0):(n(),d("div",je,t[8]||(t[8]=[s("span",null,"Для бронирования желаний нужно зарегистрироваться",-1)])))]))])])]))])],64)}}},ts=C(Je,[["__scopeId","data-v-23ab5605"]]);export{ts as default};

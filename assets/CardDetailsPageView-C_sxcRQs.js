import{_ as C,y as L,l as x,I as T,o as i,c,J as R,b as q,z as h,a as s,r as l,u as z,G as M,g as I,q as $,d as v,K as k,A as g,F as N,h as y,L as A,M as F,f as P,N as G,O,n as o,B as V,t as b,x as W}from"./index-B2m54ijR.js";import{W as J}from"./WiNavbar-qMcUzFTC.js";import{W as K}from"./WISpinner-Bmnh410u.js";import{g as D}from"./GetUserData-jCM42mLR.js";const Q="/wisher/assets/ozon-DIAmpGYW.png",Y="/wisher/assets/wb-_uZB1mgy.png",Z="/wisher/assets/ym-I_fhSRkn.png",j="/wisher/assets/reserved-DQT6e_Tb.png",H={__name:"WiContextMenu",setup(p){const r=L({visible:!1});function _(){r.visible=!1}function d(n){n.target.closest(".context__menu__container")||_()}return x(()=>{window.addEventListener("mousedown",d)}),T(()=>{window.removeEventListener("mousedown",d)}),(n,e)=>(i(),c("div",{class:"context__menu__container",onClick:e[1]||(e[1]=()=>r.visible=!r.visible)},[R(n.$slots,"default",{},void 0),r.visible?(i(),c("div",{key:0,class:"context__menu",onClick:e[0]||(e[0]=q(()=>{},["stop"]))},[R(n.$slots,"menu",{hideMenu:_},void 0)])):h("",!0)]))}},X=C(H,[["__scopeId","data-v-3fea2a4c"]]),ee=["open"],se={class:"modal__dialog__inner"},te={class:"modal__content"},ae={__name:"WiModal",props:{modelValue:{type:Boolean,required:!0}},setup(p){return(r,_)=>(i(),c("dialog",{class:"modal__dialog",open:p.modelValue},[s("div",se,[s("div",te,[R(r.$slots,"default",{},void 0)])])],8,ee))}},re=C(ae,[["__scopeId","data-v-4274a8ef"]]),oe={class:"card__menu__list"},ne=["onClick"],ie=["onClick"],de={class:"menu__modal__content"},ce={class:"menu__modal__buttons"},_e={__name:"WiCardMenu",setup(p){const r=l(null),_=z(),d=M(),n=l(!1),e=I();async function f(){try{const u=y(e,"wishes",r.value);await A(u),console.log(`карточка id: ${r.value} удалена.`)}catch(u){console.error("Ошибка при удалении карточки",u)}_.go(-1)}return x(()=>{r.value=d.params.uid}),(u,t)=>{const a=$("font-awesome-icon");return i(),c(N,null,[v(X,null,{menu:k(({hideMenu:m})=>[s("ul",oe,[s("li",{class:"card__menu__item card__menu__item--edit",onClick:()=>{m()}},[v(a,{icon:["fas","pen"]}),t[2]||(t[2]=g(" Редактировать "))],8,ne),s("li",{class:"card__menu__item card__menu__item--delete",onClick:()=>{m(),n.value=!0}},[v(a,{icon:["fas","trash-can"]}),t[3]||(t[3]=g(" Удалить "))],8,ie)])]),default:k(()=>[v(a,{class:"card__menu--icon",icon:["fas","ellipsis-vertical"]})]),_:1}),v(re,{modelValue:n.value,"onUpdate:modelValue":t[1]||(t[1]=m=>n.value=m)},{default:k(()=>[s("div",de,[t[4]||(t[4]=s("h3",{class:"menu__modal--confirm"}," Удалить карточку? ",-1)),t[5]||(t[5]=s("span",{class:"menu__modal--remind"},"Восстановить её будет невозможно.",-1)),s("div",ce,[s("button",{class:"menu__modal__button menu__modal__button--decline",onClick:t[0]||(t[0]=m=>n.value=!1)}," нет, я передумал "),s("button",{class:"menu__modal__button menu__modal__button--accept",onClick:f}," да, удалить ")])])]),_:1},8,["modelValue"])],64)}}},le=C(_e,[["__scopeId","data-v-0559e9c6"]]),ue=F("card",()=>{const p=l({}),r=l(null),_=l({}),d=l({}),n=l(!0),e=l(!0),f=l(!1),u=l(""),t=l(!1),a=I(),m=P();return{isLoading:n,currentUser:r,isReserved:t,reservedBy:u,user:p,blockSelfReserve:e,reservedUser:_,hasEditPermission:f,card:d,getCardData:async E=>{try{n.value=!0;const w=await G(y(a,"wishes",E)),B=w.exists()?w.data():null;if(r.value=m.currentUser,B){d.value=B,u.value=d.value.reserve||"",t.value=!!d.value.reserve;const U=await D(d.value.userId);p.value=U.user,r.value.uid===d.value.userId&&(e.value=!1)}if(d.value.reserve){const U=await D(d.value.reserve);_.value=U.user,r.value&&r.value.uid===_.value.uid&&(f.value=!0)}}catch(w){console.log(w,"wicardstore")}finally{n.value=!1}}}}),me={class:"card"},ve={key:0,class:"card__user__info skeleton-loader"},pe={key:1},fe={class:"card__user__info"},ge={class:"card__user__wrapper"},he={class:"card__img-wrapper--avatar"},ke=["src"],we={key:0},be=["href"],ye={key:1},Ce={class:"card__menu"},Ue={class:"card__wrapper"},Re={class:"card__images"},$e={class:"card__description"},De={class:"card__img__wrapper--description"},xe=["src"],Ie={class:"card__links"},Se={class:"card__links-wrapper"},Be={class:"card__links--item"},Ve=["href"],We={class:"card__links--item"},Me=["href"],Ne={class:"card__links--item"},Pe=["href"],Ee={class:"card__description__info"},Le={class:"card__description__user"},Te={class:"user__title"},qe={class:"user__description"},ze={key:1,class:"card__description--actions"},Ae={key:0,class:"card__description--reserved"},Fe={key:1,class:"card__description--reserved"},Ge={key:1},Oe={__name:"CardDetailsPageView",setup(p){const r=I(),_=P(),d=M(),n=l(!1),e=ue(),{getCardData:f}=e;O(e.card,t=>{t.reserve?(e.blockSelfReserve=e.currentUser.uid!==t.userId,console.log(e.blockSelfReserve=e.currentUser.uid!==t.userId)):e.blockSelfReserve=!0});async function u(){e.hasEditPermission=!0;try{n.value=!0;const t=_.currentUser,a=await D(t.uid);e.isReserved&&e.reservedBy===t.uid?(await W(y(r,"wishes",e.card.id),{reserve:""}),e.reservedBy="",e.isReserved=!1,e.reservedUser={}):e.isReserved||(await W(y(r,"wishes",e.card.id),{reserve:_.currentUser.uid}),e.reservedBy=t.uid,e.isReserved=!0,e.reservedUser=a.user)}catch(t){console.log(t,"Ошибка при резерве карточки")}finally{n.value=!1}}return x(async()=>{try{await f(d.params.uid)}catch(t){console.error("не удалось загрузить данные карточки:",t)}}),(t,a)=>{const m=$("router-link"),S=$("font-awesome-icon");return i(),c(N,null,[v(J),s("div",me,[o(e).isLoading?(i(),c("div",ve)):(i(),c("div",pe,[s("div",fe,[s("div",ge,[s("div",he,[s("img",{class:"card__image card__image--user",src:o(e).user.photoUrl,alt:""},null,8,ke)]),v(m,{to:{name:"UserProfile",params:{uid:o(e).user.uid}},class:"card__user-name"},{default:k(()=>[g(b(o(e).user.displayName),1)]),_:1},8,["to"]),o(e).card.link?(i(),c("span",we,[a[0]||(a[0]=g(" поделился ссылкой ")),s("a",{href:o(e).card.link,target:"_blank",rel:"noopener noreferrer"},[v(S,{icon:["fas","up-right-from-square"]})],8,be)])):(i(),c("span",ye,"не указал ссылку"))]),s("div",Ce,[o(e).blockSelfReserve?h("",!0):(i(),V(le,{key:0}))])]),s("div",Ue,[s("div",Re,[s("div",$e,[s("div",De,[s("img",{class:"card__image card__image--description",src:o(e).card.img,alt:""},null,8,xe)])]),s("div",Ie,[a[4]||(a[4]=s("h3",null,"Найти на маркетплейсах",-1)),s("div",Se,[s("div",Be,[s("a",{href:`https://www.ozon.ru/search/?from_global=true&text=${encodeURIComponent(o(e).card.name)}`,target:"_blank"},a[1]||(a[1]=[s("img",{class:"card__image card__links--img",src:Q,alt:""},null,-1)]),8,Ve)]),s("div",We,[s("a",{href:`https://www.wildberries.ru/catalog/0/search.aspx?search=${encodeURIComponent(o(e).card.name)}`,target:"_blank"},a[2]||(a[2]=[s("img",{class:"card__image card__links--img",src:Y,alt:""},null,-1)]),8,Me)]),s("div",Ne,[s("a",{href:`https://market.yandex.ru/search?text=${encodeURIComponent(o(e).card.name)}`,target:"_blank"},a[3]||(a[3]=[s("img",{class:"card__image card__links--img",src:Z,alt:""},null,-1)]),8,Pe)])])])]),s("div",Ee,[s("div",Le,[s("h1",Te,b(o(e).card.name),1),s("span",qe,b(o(e).card.description),1)]),n.value?(i(),V(K,{key:0,class:"card__spinner"})):(i(),c("div",ze,[o(e).isReserved?(i(),c("div",Ae,[o(e).hasEditPermission?(i(),c("button",{key:0,class:"card__button card__button-free",onClick:u}," отказаться ")):h("",!0),a[6]||(a[6]=s("div",null,[s("img",{class:"card__description--stamp",src:j,alt:""})],-1)),s("span",null,[a[5]||(a[5]=g("Зарезервировано пользователем ")),v(m,{to:{name:"UserProfile",params:{uid:o(e).reservedUser.uid}},class:"card__user-name"},{default:k(()=>[g(b(o(e).reservedUser.displayName),1)]),_:1},8,["to"])])])):(i(),c("div",Fe,[o(e).blockSelfReserve?(i(),c("button",{key:0,class:"card__button card__button-reserved",onClick:u}," зарезервировать ")):h("",!0),o(e).blockSelfReserve?(i(),c("span",Ge,"Pарезервируйте этот подарок, если хотите его подарить.")):h("",!0)]))]))])])]))])],64)}}},Ze=C(Oe,[["__scopeId","data-v-4be0da6e"]]);export{Ze as default};

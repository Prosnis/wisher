import{_ as I,r as _,o as r,c as l,G as $,b as q,k as U,a as e,u as z,C as T,g as B,j as A,A as W,d as g,H as R,l as C,F as E,h as x,I as G,J as j,f as F,K as H,D as J,L as K,n as a,t as M,q as Q,i as V}from"./index-FYdH7f92.js";import{W as Y}from"./WiNavbar-R8EHt1fp.js";import{W as Z}from"./WISpinner-kGsMMZWN.js";import{g as S}from"./GetUserData-BTGUAlWt.js";const O="/wisher/assets/ozon-DIAmpGYW.png",X="/wisher/assets/wb-_uZB1mgy.png",ee="/wisher/assets/ym-I_fhSRkn.png",se="/wisher/assets/reserved-DQT6e_Tb.png",ae={__name:"WiContextMenu",setup(h){const s=_(!1);function d(){s.value=!s.value}return(m,n)=>(r(),l("div",{class:"context-menu-container",onClick:d},[$(m.$slots,"default",{},void 0),s.value?(r(),l("div",{key:0,class:"context-menu",onClick:n[0]||(n[0]=q(()=>{},["stop"]))},[$(m.$slots,"menu",{},void 0)])):U("",!0)]))}},te=I(ae,[["__scopeId","data-v-c927f4f0"]]),oe={class:"modal__dialog__inner"},re={class:"modal__content"},ne={__name:"WiModal",setup(h,{expose:s}){const d=_(null);function m(){d.value.showModal()}function n(){d.value.close()}return s({openModal:m,closeModal:n}),(v,k)=>(r(),l("dialog",{ref_key:"dialogRef",ref:d,class:"modal__dialog"},[e("div",oe,[e("div",re,[$(v.$slots,"default",{},void 0)])])],512))}},ie=I(ne,[["__scopeId","data-v-f9599fc5"]]),le={class:"card__menu__list"},ce={class:"card__menu__item card__menu__item--edit"},_e={__name:"WiCardMenu",setup(h){const s=_(null),d=z(),m=T(),n=_(null),v=B();function k(){n.value.openModal()}function t(){n.value.closeModal()}async function y(){try{const p=x(v,"wishes",s.value);await G(p),console.log(`карточка id: ${s.value} удалена.`)}catch(p){console.error("Ошибка при удалении карточки",p)}d.go(-1)}return A(()=>{s.value=m.params.uid}),(p,i)=>{const f=W("font-awesome-icon");return r(),l(E,null,[g(te,null,{menu:R(()=>[e("ul",le,[e("li",ce,[g(f,{icon:["fas","pen"]}),i[0]||(i[0]=C(" Редактировать "))]),e("li",{class:"card__menu__item card__menu__item--delete",onClick:k},[g(f,{icon:["fas","trash-can"]}),i[1]||(i[1]=C(" Удалить "))])])]),default:R(()=>[g(f,{class:"card__menu--icon",icon:["fas","ellipsis-vertical"]})]),_:1}),g(ie,{ref_key:"modalRef",ref:n},{default:R(()=>[e("div",{class:"menu__modal__content"},[i[2]||(i[2]=e("h3",null,"Удалить подарок?",-1)),i[3]||(i[3]=e("span",null,"Восстановить его будет невозможно.",-1)),e("div",{class:"menu__modal__buttons"},[e("button",{class:"menu__modal__button menu__modal__button--decline",onClick:t}," нет, я передумал "),e("button",{class:"menu__modal__button menu__modal__button--accept",onClick:y}," да, удалить ")])])]),_:1},512)],64)}}},de=I(_e,[["__scopeId","data-v-22b05b25"]]),ue=j("card",()=>{const h=_(!0),s=_(null),d=_(""),m=_({}),n=_(!0),v=_({}),k=_(!1),t=_({}),y=B(),p=F(),i=_(!1);return{isLoading:h,currentUser:s,isReserved:i,reservedBy:d,user:m,blockSelfReserve:n,reservedUser:v,hasEditPermission:k,card:t,getCardData:async b=>{try{h.value=!0;const w=await H(x(y,"wishes",b)),c=w.exists()?w.data():null;if(s.value=p.currentUser,c){t.value=c,d.value=t.value.reserve||"",i.value=!!t.value.reserve;const D=await S(t.value.userId);m.value=D.user,s.value.uid===t.value.userId&&(n.value=!1)}if(t.value.reserve){const D=await S(t.value.reserve);v.value=D.user,s.value&&s.value.uid===v.value.uid&&(k.value=!0)}}catch(w){console.log(w,"wicardstore")}finally{h.value=!1}}}}),me={class:"card"},ve={key:0,class:"card__user__info skeleton-loader"},pe={key:1},fe={class:"card__user__info"},ge={class:"card__user__wrapper"},he={class:"card__img-wrapper--avatar"},ke=["src"],we={key:0},ye=["href"],be={key:1},Ce={class:"card__menu"},De={class:"card__wrapper"},Re={class:"card__images"},Me={class:"card__description"},Ue={class:"card__img__wrapper--description"},xe=["src"],Ie={class:"card__links"},$e={class:"card__links-wrapper"},We={class:"card__links--item"},Se=["href"],Be={class:"card__links--item"},Ne=["href"],Pe={class:"card__links--item"},Ve=["href"],Te={class:"card__description__info"},Ae={class:"card__description__user"},Ee={key:1,class:"card__description--actions"},Fe={key:0,class:"card__description--reserved"},Le={key:1,class:"card__description--reserved"},qe={key:1},ze={__name:"CardDetailsPageView",setup(h){const s=B(),d=F(),m=T(),n=_(!1),v=ue(),{isLoading:k,isReserved:t,currentUser:y,reservedBy:p,user:i,blockSelfReserve:f,reservedUser:b,hasEditPermission:w,card:c}=J(v),{getCardData:D}=v;K(c,u=>{u.reserve?(f.value=y.value.uid!==u.userId,console.log(f.value=y.value.uid!==u.userId)):f.value=!0});async function N(){w.value=!0;try{n.value=!0;const u=d.currentUser,o=await S(u.uid);t.value&&p.value===u.uid?(await V(x(s,"wishes",c.value.id),{reserve:""}),p.value="",t.value=!1,b.value={}):t.value||(await V(x(s,"wishes",c.value.id),{reserve:d.currentUser.uid}),p.value=u.uid,t.value=!0,b.value=o.user)}catch(u){console.log(u,"Ошибка при резерве карточки")}finally{n.value=!1}}return A(async()=>{try{await D(m.params.uid)}catch(u){console.error("не удалось загрузить данные карточки:",u)}}),(u,o)=>{const P=W("router-link"),L=W("font-awesome-icon");return r(),l(E,null,[g(Y),e("div",me,[a(k)?(r(),l("div",ve)):(r(),l("div",pe,[e("div",fe,[e("div",ge,[e("div",he,[e("img",{class:"card__image card__image--user",src:a(i).photoUrl,alt:""},null,8,ke)]),g(P,{to:{name:"UserProfile",params:{uid:a(i).uid}},class:"card__user-name"},{default:R(()=>[C(M(a(i).displayName),1)]),_:1},8,["to"]),a(c).link?(r(),l("span",we,[o[0]||(o[0]=C(" поделился ссылкой ")),e("a",{href:a(c).link,target:"_blank",rel:"noopener noreferrer"},[g(L,{icon:["fas","up-right-from-square"]})],8,ye)])):(r(),l("span",be,"не указал ссылку"))]),e("div",Ce,[g(de)])]),e("div",De,[e("div",Re,[e("div",Me,[e("div",Ue,[e("img",{class:"card__image card__image--description",src:a(c).img,alt:""},null,8,xe)])]),e("div",Ie,[o[4]||(o[4]=e("h3",null,"Найти на маркетплейсах",-1)),e("div",$e,[e("div",We,[e("a",{href:`https://www.ozon.ru/search/?from_global=true&text=${encodeURIComponent(a(c).name)}`,target:"_blank"},o[1]||(o[1]=[e("img",{class:"card__image card__links--img",src:O,alt:""},null,-1)]),8,Se)]),e("div",Be,[e("a",{href:`https://www.wildberries.ru/catalog/0/search.aspx?search=${encodeURIComponent(a(c).name)}`,target:"_blank"},o[2]||(o[2]=[e("img",{class:"card__image card__links--img",src:X,alt:""},null,-1)]),8,Ne)]),e("div",Pe,[e("a",{href:`https://market.yandex.ru/search?text=${encodeURIComponent(a(c).name)}`,target:"_blank"},o[3]||(o[3]=[e("img",{class:"card__image card__links--img",src:ee,alt:""},null,-1)]),8,Ve)])])])]),e("div",Te,[e("div",Ae,[e("h1",null,M(a(c).name),1),e("span",null,M(a(c).description),1)]),n.value?(r(),Q(Z,{key:0,class:"card__spinner"})):(r(),l("div",Ee,[a(t)?(r(),l("div",Fe,[a(w)?(r(),l("button",{key:0,class:"card__button card__button-free",onClick:N}," отказаться ")):U("",!0),o[6]||(o[6]=e("div",null,[e("img",{class:"card__description--stamp",src:se,alt:""})],-1)),e("span",null,[o[5]||(o[5]=C("Зарезервировано пользователем ")),g(P,{to:{name:"UserProfile",params:{uid:a(b).uid}},class:"card__user-name"},{default:R(()=>[C(M(a(b).displayName),1)]),_:1},8,["to"])])])):(r(),l("div",Le,[a(f)?(r(),l("button",{key:0,class:"card__button card__button-reserved",onClick:N}," зарезервировать ")):U("",!0),a(f)?(r(),l("span",qe,"Pарезервируйте этот подарок, если хотите его подарить.")):U("",!0)]))]))])])]))])],64)}}},Ke=I(ze,[["__scopeId","data-v-f095c343"]]);export{Ke as default};

import{_ as J,g as Q,f as G,r as _,y as K,c as p,d as U,a as s,A as Z,w as y,v as h,b as B,C as D,B as x,n as V,F as P,m as X,t as C,G as F,z,o as n,E as ee,u as se,s as te,h as ae,q as oe,p as re}from"./index-CIa3Xx9T.js";import{W as ne}from"./WiNavbar-nKao627v.js";import{b as ie}from"./UserBadgesStore-jHlPkzW9.js";import{u as le}from"./WiProfileStore-D3VDznkh.js";import{C as j}from"./vue-content-loader.es-BZWtuUsv.js";const ce="/wisher/assets/box-C3QgpmQ8.jpg",A=["Искусство","Музыка","Танцы","Спорт","Кулинария","Путешествия","Чтение","Садоводство","Рукоделие","Игры","Фотография","Коллекционирование","Технологии","Писательство","Фитнес и здоровье","Рыбалка и охота","Автомобили и мотоциклы","Наука","Моделирование","Саморазвитие","Животные и природа","Экстрим","Мода и стиль","Кино и сериалы","Активный отдых","Электроника","Видеоблогинг","Косметология"],de="Bearer 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",N=10;async function ue(k){try{const i=[];for(let r=0;r<A.length;r+=N){const f=A.slice(r,r+N),d=await fetch("https://api-inference.huggingface.co/models/MoritzLaurer/bge-m3-zeroshot-v2.0",{method:"POST",headers:{"Content-Type":"application/json",Authorization:de},body:JSON.stringify({inputs:k,parameters:{candidate_labels:f}})});if(!d.ok)throw new Error(`Ошибка HTTP: ${d.status}`);const m=await d.json(),{labels:g,scores:v}=m,b=g.map((u,l)=>({label:u,score:v[l]})).sort((u,l)=>l.score-u.score);i.push(...b.slice(0,3))}return console.log("Результаты классификации:",i),i}catch(i){console.error("Ошибка при запросе:",i.message)}}async function _e(k){const i="http://212.22.90.119:3000/fetch-product";try{const r=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:k})});if(!r.ok)throw new Error(`Ошибка HTTP: ${r.status}`);const f=await r.json();return console.log("Данные о товаре:",f),f}catch(r){console.error("Ошибка:",r.message)}}const pe={class:"container"},fe={class:"parser"},me=["disabled"],ge=["disabled"],ve={class:"form__list"},be={class:"form__list__item"},ye={class:"form__list__item"},he={class:"form__list__item"},ke={class:"form__list__item"},we={class:"form__badge__item"},xe={key:0,class:"form__badge__wrapper"},Ce=["onClick"],Te={key:1,class:"form__badge__spinner"},Se={key:3,class:"form__preview"},Ue={class:"form__preview__card"},Be={class:"card__label card__label--file",for:"file-input"},De=["src"],Ve={class:"card__title"},Pe={__name:"WiCardAddView",setup(k){const i=se(),r=Q(),f=G(),d=_(!1),m=_(""),g=_(!0),v=_(!1),T=_("Заполнить вручную"),b=_("Ожидаем название.."),u=_(!1),l=_([]),L=le(),{addWish:O}=L;function $(){g.value=!g.value,T.value=g.value?"Заполнить вручную":"Создать из ссылки"}const t=K({img:"",name:"",description:"",price:"",date:new Date().toLocaleDateString(),link:"",badge:[]});async function E(){try{u.value=!0,d.value=!0;const a=m.value,e=await _e(a);t.img=e.image,t.name=e.title,t.description=e.description,t.link=e.link,t.price=e.price,$(),v.value=!1,S(t.name)}catch(a){console.log("parseFromYandex",a),v.value=!0}finally{u.value=!1,d.value=!1}}function I(){Object.assign(t,{img:"",name:"",description:"",price:"",date:"",link:""})}function W(a){return{id:crypto.randomUUID(),userId:f.currentUser.uid,img:a.img||ce,name:a.name,hover:!1,description:a.description||"Описание отсутствует. ",price:a.price||0,date:a.date||new Date().toLocaleDateString(),link:a.link,reserve:"",badge:a.badge,fulfilled:!1}}function Y(){i.push(`${re.user}/${f.currentUser.uid}`)}async function H(){const a=W(t);console.log("123");try{await te(ae(r,"wishes",a.id),a),O(a),I(),Y()}catch(e){console.log(e,"Ошибка при создании карточки")}}function M(a){const e=a.target.files[0];if(e){const c=new FileReader;c.onload=o=>{t.img=o.target.result},c.readAsDataURL(e)}}function w(a){return t.badge.some(e=>e.name===a.name)}function q(a){const e=t.badge.findIndex(c=>c.name===a.name);t.badge.length&&e||(e!==-1?t.badge.splice(e,1):t.badge.push(a))}async function S(a){if(t.name)try{b.value="Подбираем категорию..",l.value=[];const e=await ue(a);l.value=ie.filter(c=>e.some(o=>c.name.includes(o.label)))}catch(e){console.error(e),l.value=[]}finally{b.value="Выберите подходящую категорию:"}}return(a,e)=>{const c=oe("font-awesome-icon");return n(),p(P,null,[U(ne),s("div",pe,[s("div",fe,[e[7]||(e[7]=s("span",{class:"parser__title"},[Z("Найти товар на "),s("a",{href:"https://market.yandex.ru/",target:"_blank",class:"parser__title--link"},"Яндекс Маркет")],-1)),y(s("input",{id:"link","onUpdate:modelValue":e[0]||(e[0]=o=>m.value=o),class:"parser__input",type:"text",maxlength:"200",required:""},null,512),[[h,m.value]]),s("button",{class:"parser__button",onClick:B(E,["prevent","stop"])}," Создать желание по ссылке "),s("span",{class:D([v.value?"parser__error":"parser__error--visible"])},"Произошла ошибка. Пожалуйста, проверьте ссылку или заполните форму вручную.",2)]),s("form",{onSubmit:B(H,["prevent"])},[s("fieldset",{disabled:u.value,class:"form fieldset"},[d.value?(n(),x(V(j),{key:0,class:"form__preview",viewBox:"0 0 430 540",speed:2,"primary-color":"#f5f7fa","secondary-color":"#eaeff5"},{default:F(()=>e[8]||(e[8]=[s("rect",{x:"0",y:"0",rx:"10",ry:"10",width:"430",height:"540"},null,-1)])),_:1})):(n(),p("div",{key:1,class:"form__input__group",disabled:u.value},[s("ul",ve,[s("li",be,[e[9]||(e[9]=s("label",{class:"form__label",for:"name"},"Название:",-1)),y(s("input",{id:"name","onUpdate:modelValue":e[1]||(e[1]=o=>t.name=o),class:"form__input",type:"text",required:"",maxlength:"80",onChange:e[2]||(e[2]=o=>S(t.name))},null,544),[[h,t.name]])]),s("li",ye,[e[10]||(e[10]=s("label",{class:"form__label",for:"description"},"Описание",-1)),y(s("textarea",{id:"description","onUpdate:modelValue":e[3]||(e[3]=o=>t.description=o),class:"form__textarea",type:"text",maxlength:"100"},null,512),[[h,t.description]])]),s("li",he,[e[11]||(e[11]=s("label",{class:"form__label",for:"price"},"Цена",-1)),y(s("input",{id:"price","onUpdate:modelValue":e[4]||(e[4]=o=>t.price=o),class:"form__input",type:"number",maxlength:"100",oninput:"this.value = this.value.slice(0, 10)"},null,512),[[h,t.price]])]),s("li",ke,[e[12]||(e[12]=s("label",{class:"form__label",for:"link"},"Ссылка на товар",-1)),y(s("input",{id:"link","onUpdate:modelValue":e[5]||(e[5]=o=>t.link=o),class:"form__input",type:"text",maxlength:"200"},null,512),[[h,t.link]])]),s("li",we,[s("div",null,[l.value.length>0?(n(),p("div",xe,[(n(!0),p(P,null,X(l.value,(o,R)=>(n(),p("div",{key:R,class:D([w(o)?"form__badge__picked":"form__badge"]),style:ee({backgroundColor:w(o)?"#0817ecb9":"#f5f7fa",color:w(o)?"#f0f0f0":"#0817ecb9"}),onClick:Fe=>q(o)},C(o.name),15,Ce))),128))])):(n(),p("div",Te,[s("span",null,C(b.value),1),U(c,{class:"badge__icon--loading",icon:["fas","circle-notch"],spin:""})]))])])])],8,ge)),d.value?(n(),x(V(j),{key:2,class:"form__preview",viewBox:"0 0 430 540",speed:2,"primary-color":"#f5f7fa","secondary-color":"#eaeff5"},{default:F(()=>e[13]||(e[13]=[s("rect",{x:"0",y:"0",rx:"10",ry:"10",width:"430",height:"540"},null,-1)])),_:1})):(n(),p("div",Se,[s("div",Ue,[s("label",Be,[t.img?(n(),p("img",{key:0,src:t.img,alt:"",class:"card__image"},null,8,De)):z("",!0),t.img?z("",!0):(n(),x(c,{key:1,class:"card__icon--file",icon:["fas","file-image"]})),s("input",{id:"file-input",class:"card__input card__input--file",type:"file",onChange:e[6]||(e[6]=o=>M(o))},null,32)]),s("h3",Ve,C(t.name),1)]),e[14]||(e[14]=s("button",{class:"form__button--add"}," добавить ",-1))]))],8,me)],32)])],64)}}},Oe=J(Pe,[["__scopeId","data-v-37627bd8"]]);export{Oe as default};

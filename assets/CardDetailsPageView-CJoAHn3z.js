import{_ as I,r as u,j as B,G as q,o as n,c,H as $,b as z,k as U,a as e,u as G,C as L,g as N,A as W,d as h,I as M,l as C,F as T,h as x,J as j,K as H,f as A,L as J,D as K,M as O,n as t,t as R,q as Q,i as E}from"./index-CXqJU6vN.js";import{W as Y}from"./WiNavbar-CjuK7DFl.js";import{W as Z}from"./WISpinner-C1f-VMNE.js";import{g as S}from"./GetUserData-DmtXfbm2.js";const X="/wisher/assets/ozon-DIAmpGYW.png",ee="/wisher/assets/wb-_uZB1mgy.png",se="/wisher/assets/ym-I_fhSRkn.png",te="/wisher/assets/reserved-DQT6e_Tb.png",ae={__name:"WiContextMenu",setup(w){const s=u(!1),_=()=>{s.value=!1},p=()=>{s.value=!s.value},r=i=>{i.target.closest(".context__menu__container")||_()};return B(()=>{window.addEventListener("mousedown",r)}),q(()=>{window.removeEventListener("mousedown",r)}),(i,v)=>(n(),c("div",{class:"context__menu__container",onClick:p},[$(i.$slots,"default",{},void 0),s.value?(n(),c("div",{key:0,class:"context__menu",onClick:v[0]||(v[0]=z(()=>{},["stop"]))},[$(i.$slots,"menu",{hideMenu:_},void 0)])):U("",!0)]))}},oe=I(ae,[["__scopeId","data-v-3d40ac28"]]),ne={class:"modal__dialog__inner"},re={class:"modal__content"},ie={__name:"WiModal",setup(w,{expose:s}){const _=u(null);function p(){_.value.showModal()}function r(){_.value.close()}return s({openModal:p,closeModal:r}),(i,v)=>(n(),c("dialog",{ref_key:"dialogRef",ref:_,class:"modal__dialog"},[e("div",ne,[e("div",re,[$(i.$slots,"default",{},void 0)])])],512))}},le=I(ie,[["__scopeId","data-v-f9599fc5"]]),ce={class:"card__menu__list"},_e=["onClick"],de=["onClick"],ue={__name:"WiCardMenu",setup(w){const s=u(null),_=G(),p=L(),r=u(null),i=N();function v(){r.value.openModal()}function a(){r.value.closeModal()}async function b(){try{const f=x(i,"wishes",s.value);await j(f),console.log(`карточка id: ${s.value} удалена.`)}catch(f){console.error("Ошибка при удалении карточки",f)}_.go(-1)}return B(()=>{s.value=p.params.uid}),(f,l)=>{const g=W("font-awesome-icon");return n(),c(T,null,[h(oe,null,{menu:M(({hideMenu:k})=>[e("ul",ce,[e("li",{class:"card__menu__item card__menu__item--edit",onClick:()=>{k()}},[h(g,{icon:["fas","pen"]}),l[0]||(l[0]=C(" Редактировать "))],8,_e),e("li",{class:"card__menu__item card__menu__item--delete",onClick:()=>{k(),v()}},[h(g,{icon:["fas","trash-can"]}),l[1]||(l[1]=C(" Удалить "))],8,de)])]),default:M(()=>[h(g,{class:"card__menu--icon",icon:["fas","ellipsis-vertical"]})]),_:1}),h(le,{ref_key:"modalRef",ref:r},{default:M(()=>[e("div",{class:"menu__modal__content"},[l[2]||(l[2]=e("h3",null,"Удалить подарок?",-1)),l[3]||(l[3]=e("span",null,"Восстановить его будет невозможно.",-1)),e("div",{class:"menu__modal__buttons"},[e("button",{class:"menu__modal__button menu__modal__button--decline",onClick:a}," нет, я передумал "),e("button",{class:"menu__modal__button menu__modal__button--accept",onClick:b}," да, удалить ")])])]),_:1},512)],64)}}},me=I(ue,[["__scopeId","data-v-8374a082"]]),ve=H("card",()=>{const w=u(!0),s=u(null),_=u(""),p=u({}),r=u(!0),i=u({}),v=u(!1),a=u({}),b=N(),f=A(),l=u(!1);return{isLoading:w,currentUser:s,isReserved:l,reservedBy:_,user:p,blockSelfReserve:r,reservedUser:i,hasEditPermission:v,card:a,getCardData:async k=>{try{w.value=!0;const y=await J(x(b,"wishes",k)),d=y.exists()?y.data():null;if(s.value=f.currentUser,d){a.value=d,_.value=a.value.reserve||"",l.value=!!a.value.reserve;const D=await S(a.value.userId);p.value=D.user,s.value.uid===a.value.userId&&(r.value=!1)}if(a.value.reserve){const D=await S(a.value.reserve);i.value=D.user,s.value&&s.value.uid===i.value.uid&&(v.value=!0)}}catch(y){console.log(y,"wicardstore")}finally{w.value=!1}}}}),pe={class:"card"},fe={key:0,class:"card__user__info skeleton-loader"},ge={key:1},he={class:"card__user__info"},ke={class:"card__user__wrapper"},we={class:"card__img-wrapper--avatar"},ye=["src"],be={key:0},Ce=["href"],De={key:1},Me={class:"card__menu"},Re={class:"card__wrapper"},Ue={class:"card__images"},xe={class:"card__description"},Ie={class:"card__img__wrapper--description"},$e=["src"],We={class:"card__links"},Se={class:"card__links-wrapper"},Be={class:"card__links--item"},Ne=["href"],Pe={class:"card__links--item"},Ve=["href"],Ee={class:"card__links--item"},Le=["href"],Te={class:"card__description__info"},Ae={class:"card__description__user"},Fe={key:1,class:"card__description--actions"},qe={key:0,class:"card__description--reserved"},ze={key:1,class:"card__description--reserved"},Ge={key:1},je={__name:"CardDetailsPageView",setup(w){const s=N(),_=A(),p=L(),r=u(!1),i=ve(),{isLoading:v,isReserved:a,currentUser:b,reservedBy:f,user:l,blockSelfReserve:g,reservedUser:k,hasEditPermission:y,card:d}=K(i),{getCardData:D}=i;O(d,m=>{m.reserve?(g.value=b.value.uid!==m.userId,console.log(g.value=b.value.uid!==m.userId)):g.value=!0});async function P(){y.value=!0;try{r.value=!0;const m=_.currentUser,o=await S(m.uid);a.value&&f.value===m.uid?(await E(x(s,"wishes",d.value.id),{reserve:""}),f.value="",a.value=!1,k.value={}):a.value||(await E(x(s,"wishes",d.value.id),{reserve:_.currentUser.uid}),f.value=m.uid,a.value=!0,k.value=o.user)}catch(m){console.log(m,"Ошибка при резерве карточки")}finally{r.value=!1}}return B(async()=>{try{await D(p.params.uid)}catch(m){console.error("не удалось загрузить данные карточки:",m)}}),(m,o)=>{const V=W("router-link"),F=W("font-awesome-icon");return n(),c(T,null,[h(Y),e("div",pe,[t(v)?(n(),c("div",fe)):(n(),c("div",ge,[e("div",he,[e("div",ke,[e("div",we,[e("img",{class:"card__image card__image--user",src:t(l).photoUrl,alt:""},null,8,ye)]),h(V,{to:{name:"UserProfile",params:{uid:t(l).uid}},class:"card__user-name"},{default:M(()=>[C(R(t(l).displayName),1)]),_:1},8,["to"]),t(d).link?(n(),c("span",be,[o[0]||(o[0]=C(" поделился ссылкой ")),e("a",{href:t(d).link,target:"_blank",rel:"noopener noreferrer"},[h(F,{icon:["fas","up-right-from-square"]})],8,Ce)])):(n(),c("span",De,"не указал ссылку"))]),e("div",Me,[h(me)])]),e("div",Re,[e("div",Ue,[e("div",xe,[e("div",Ie,[e("img",{class:"card__image card__image--description",src:t(d).img,alt:""},null,8,$e)])]),e("div",We,[o[4]||(o[4]=e("h3",null,"Найти на маркетплейсах",-1)),e("div",Se,[e("div",Be,[e("a",{href:`https://www.ozon.ru/search/?from_global=true&text=${encodeURIComponent(t(d).name)}`,target:"_blank"},o[1]||(o[1]=[e("img",{class:"card__image card__links--img",src:X,alt:""},null,-1)]),8,Ne)]),e("div",Pe,[e("a",{href:`https://www.wildberries.ru/catalog/0/search.aspx?search=${encodeURIComponent(t(d).name)}`,target:"_blank"},o[2]||(o[2]=[e("img",{class:"card__image card__links--img",src:ee,alt:""},null,-1)]),8,Ve)]),e("div",Ee,[e("a",{href:`https://market.yandex.ru/search?text=${encodeURIComponent(t(d).name)}`,target:"_blank"},o[3]||(o[3]=[e("img",{class:"card__image card__links--img",src:se,alt:""},null,-1)]),8,Le)])])])]),e("div",Te,[e("div",Ae,[e("h1",null,R(t(d).name),1),e("span",null,R(t(d).description),1)]),r.value?(n(),Q(Z,{key:0,class:"card__spinner"})):(n(),c("div",Fe,[t(a)?(n(),c("div",qe,[t(y)?(n(),c("button",{key:0,class:"card__button card__button-free",onClick:P}," отказаться ")):U("",!0),o[6]||(o[6]=e("div",null,[e("img",{class:"card__description--stamp",src:te,alt:""})],-1)),e("span",null,[o[5]||(o[5]=C("Зарезервировано пользователем ")),h(V,{to:{name:"UserProfile",params:{uid:t(k).uid}},class:"card__user-name"},{default:M(()=>[C(R(t(k).displayName),1)]),_:1},8,["to"])])])):(n(),c("div",ze,[t(g)?(n(),c("button",{key:0,class:"card__button card__button-reserved",onClick:P}," зарезервировать ")):U("",!0),t(g)?(n(),c("span",Ge,"Pарезервируйте этот подарок, если хотите его подарить.")):U("",!0)]))]))])])]))])],64)}}},Qe=I(je,[["__scopeId","data-v-4410909d"]]);export{Qe as default};

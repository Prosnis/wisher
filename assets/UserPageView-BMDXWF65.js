import{_ as W,r as n,o as u,c as m,a as e,h as x,z as J,A,g as S,e as I,f as M,i as E,B as j,l as K,k as $,F as D,C as V,w as N,v as P,m as R,t as C,n as Q,D as X,u as Y,p as Z,q as L,s as ee,j as z,E as O,G as oe,H as se}from"./index-CWayI_7h.js";import{W as ae}from"./WiNavbar-B2Tb-diI.js";import{g as te,r as re,u as le,a as ne}from"./index.esm2017-BhZ2QlUK.js";import{g as q}from"./GetUserData-U0EVY8MB.js";const ie={class:"modal__dialog__inner"},ue={class:"modal__content"},de={__name:"WiModal",setup(p,{expose:s}){const t=n(null);function f(){t.value.showModal()}function c(){t.value.close()}return s({openModal:f,closeModal:c}),(_,l)=>{const o=A("font-awesome-icon");return u(),m("dialog",{ref_key:"dialogRef",ref:t,class:"modal__dialog"},[e("div",ie,[e("button",{class:"modal__button modal__button--close",onClick:c},[x(o,{class:"modal__icon--close modal__icon",icon:["fas","close"]})]),e("div",ue,[J(_.$slots,"default",{},void 0)])])],512)}}},T=W(de,[["__scopeId","data-v-15099eb1"]]),ce=S(),pe=te(),_e=I();async function F(p,s){const t=re(pe,s);return await le(t,p),await ne(t)}async function me(p,s,t,f){f.value=!0;const c=_e.currentUser,_=M(ce,"users",c.uid),l={};try{if(t.value){const o=await F(t.value,`avatars/${c.uid}`);l.photoUrl=o,p.photoUrl=o}if(s.value){const o=await F(s.value,`wallpapers/${c.uid}`);l.wallpaperUrl=o,p.wallpaperUrl=o}return await E(_,l),console.log("Профиль успешно обновлен"),{avatarUrl:l.photoUrl,wallpaperUrl:l.wallpaperUrl}}catch(o){console.log("ошибка при загрузке профиля,",o)}finally{f.value=!1}}const fe=["src"],ge={key:0,for:"input-wallaper",class:"profile__wallaper-edit"},ve={key:0,class:"profile__spinner"},be=["src"],ye={key:1,for:"input-avatar",class:"profile__photo profile__photo--edit"},he={__name:"WiUserPagePicturesEdit",props:{user:{type:Object,default:()=>({})}},setup(p){const s=p,t=n(!1),f=n(!1),c=n(null),_=n(null),l=n(!1),o=n(!1);function i(v,r){const g=r.target.files[0];v==="avatar"?_.value=g:v==="wallpaper"&&(c.value=g),me(s.user,c,_,l)}return(v,r)=>{const g=A("font-awesome-icon");return u(),m(D,null,[e("div",{class:"profile__wallapper",onMouseenter:r[2]||(r[2]=y=>t.value=!0),onMouseleave:r[3]||(r[3]=y=>t.value=!1)},[e("img",{src:s.user.wallpaperUrl,alt:"user-wallpaper",loading:"lazy",class:"profile__wallapper-img",style:j({opacity:o.value?1:0}),onLoad:r[0]||(r[0]=y=>o.value=!0)},null,44,fe),t.value?(u(),m("label",ge,[e("input",{id:"input-wallaper",class:"profile__input profile__input--wallpaper",type:"file",onChange:r[1]||(r[1]=y=>i("wallpaper",y))},null,32),r[7]||(r[7]=K(" изменить обложку "))])):$("",!0)],32),e("div",{class:"profile__photo-wrapper",onMouseenter:r[5]||(r[5]=y=>f.value=!0),onMouseleave:r[6]||(r[6]=y=>f.value=!1)},[l.value?(u(),m("div",ve)):$("",!0),e("img",{class:"profile__photo",src:s.user.photoUrl,alt:"user-photo",loading:"lazy"},null,8,be),f.value?(u(),m("label",ye,[e("input",{id:"input-avatar",class:"profile__input profile__input--avatar",type:"file",onChange:r[4]||(r[4]=y=>i("avatar",y))},null,32),x(g,{class:"profile__icon profile__icon-edit",icon:["fas","edit"]})])):$("",!0)],32)],64)}}},we=W(he,[["__scopeId","data-v-c156bfeb"]]),Ue=[{name:"Аниме",BgColor:"rgba(255, 255, 255, 1)",color:"rgba(0, 0, 0, 1)"},{name:"Рыбалка",BgColor:"rgba(255, 255, 255, 1)",color:"rgba(0, 0, 0, 1)"},{name:"Танцы",BgColor:"rgba(255, 255, 255, 1)",color:"rgba(0, 0, 0, 1)"},{name:"Хоббихорсинг",BgColor:"rgba(255, 255, 255, 1)",color:"rgba(0, 0, 0, 1)"},{name:"Квадробинг",BgColor:"rgba(255, 255, 255, 1)",color:"rgba(0, 0, 0, 1)"},{name:"Футбол",BgColor:"rgba(255, 255, 255, 1)",color:"rgba(0, 0, 0, 1)"},{name:"Рисование",BgColor:"rgba(255, 255, 255, 1)",color:"rgba(0, 0, 0, 1)"},{name:"Вышивание",BgColor:"rgba(255, 255, 255, 1)",color:"rgba(0, 0, 0, 1)"},{name:"Фитнес",BgColor:"rgba(255, 255, 255, 1)",color:"rgba(0, 0, 0, 1)"},{name:"Лего",BgColor:"rgba(255, 255, 255, 1)",color:"rgba(0, 0, 0, 1)"},{name:"Паркур",BgColor:"rgba(255, 255, 255, 1)",color:"rgba(0, 0, 0, 1)"},{name:"Кулинария",BgColor:"rgba(255, 255, 255, 1)",color:"rgba(0, 0, 0, 1)"},{name:"Фотография",BgColor:"rgba(255, 255, 255, 1)",color:"rgba(0, 0, 0, 1)"},{name:"Йога",BgColor:"rgba(255, 255, 255, 1)",color:"rgba(0, 0, 0, 1)"},{name:"Плавание",BgColor:"rgba(255, 255, 255, 1)",color:"rgba(0, 0, 0, 1)"},{name:"Велоспорт",BgColor:"rgba(255, 255, 255, 1)",color:"rgba(0, 0, 0, 1)"},{name:"Программирование",BgColor:"rgba(255, 255, 255, 1)",color:"rgba(0, 0, 0, 1)"},{name:"Чтение",BgColor:"rgba(255, 255, 255, 1)",color:"rgba(0, 0, 0, 1)"},{name:"Гейминг",BgColor:"rgba(255, 255, 255, 1)",color:"rgba(0, 0, 0, 1)"},{name:"Музыка",BgColor:"rgba(255, 255, 255, 1)",color:"rgba(0, 0, 0, 1)"},{name:"Бег",BgColor:"rgba(255, 255, 255, 1)",color:"rgba(0, 0, 0, 1)"},{name:"Садоводство",BgColor:"rgba(255, 255, 255, 1)",color:"rgba(0, 0, 0, 1)"}],Ce={class:"user-edit-list"},$e={class:"badge-wrapper"},ke=["onClick"],Be={__name:"WiUserPageSettings",props:{user:{type:Object,default:()=>({name:"Unknown",about:"Empty"})},pickedBadges:{type:Array,default:()=>[]}},emits:["close","updateProfile"],setup(p,{emit:s}){const t=p,f=s,c=n(""),_=n(""),l=I(),o=S(),i=n(t.user.displayName),v=n(t.user.about),r=n([...t.pickedBadges]);V(()=>t.user,b=>{i.value=b.displayName,v.value=b.about},{immediate:!0}),V(()=>t.pickedBadges,b=>{r.value=[...b]},{immediate:!0});function g(b){return r.value.some(d=>d.name===b.name)}function y(b){const d=r.value.findIndex(h=>h.name===b.name);d!==-1?r.value.splice(d,1):r.value.push(b),console.log(r.value)}async function k(){const b=l.currentUser;if(!b){console.error("Пользователь не авторизован");return}const d=M(o,"users",b.uid),h=await X(d),w=h.exists()?h.data():{},a={};a.displayName=_.value!==""?_.value:w.displayName||b.displayName,a.about=c.value!==""?c.value:w.about||"",a.badges=r.value.length>0?r.value:w.badges||[];try{await E(d,a),console.log("Профиль успешно обновлен"),f("updateProfile",{userName:a.displayName,userAbout:a.about,pickedBadges:a.badges})}catch(B){console.error("Ошибка при обновлении профиля:",B)}}return(b,d)=>(u(),m("form",{method:"dialog",class:"form",onSubmit:k},[d[5]||(d[5]=e("h1",null,"Редактировать профиль",-1)),e("ul",Ce,[e("li",null,[d[2]||(d[2]=e("label",{for:"name"},"Имя:",-1)),N(e("input",{id:"name","onUpdate:modelValue":d[0]||(d[0]=h=>_.value=h),type:"text"},null,512),[[P,_.value]])]),e("li",null,[d[3]||(d[3]=e("label",{for:"about"},"Краткая информация:",-1)),N(e("textarea",{id:"about","onUpdate:modelValue":d[1]||(d[1]=h=>c.value=h),name:""},null,512),[[P,c.value]])]),e("li",null,[d[4]||(d[4]=e("label",{for:""},"Выберите интересы:",-1)),e("div",$e,[(u(!0),m(D,null,R(Q(Ue),(h,w)=>(u(),m("div",{key:w,class:"badge",style:j({backgroundColor:g(h)?"green":h.BgColor,color:g(h)?"white":h.color}),onClick:a=>y(h)},C(h.name),13,ke))),128))])])]),d[6]||(d[6]=e("button",{class:"btn-modal-save"}," сохранить изменения ",-1))],32))}},xe=W(Be,[["__scopeId","data-v-5ff80c7c"]]),Ne="/wisher/assets/empty-box-D7umrX5t.png",We=["data-id"],Pe=["src"],De={card__title:""},Ie={class:"card__price"},Ae={class:"card__user__info"},Se={class:"user__info--info"},Me=["src"],Re=["textContent"],Le={class:"user__info--date"},Ve={__name:"WiCardCreate",props:{wish:{type:Object},userImg:{type:String},userName:{type:String}},setup(p){const s=p,t=Y();function f(o){t.push(`${Z.card}/${o}`).catch(i=>{console.log("Card not allowed",i)})}function c(o){return o?new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB",minimumFractionDigits:0}).format(o):""}function _(o){o.target.classList.add("card__hover")}function l(o){o.target.classList.remove("card__hover")}return(o,i)=>(u(),m("div",{class:"card","data-id":p.wish.id,onMouseenter:i[0]||(i[0]=v=>_(v)),onMouseleave:i[1]||(i[1]=v=>l(v)),onClick:i[2]||(i[2]=v=>f(p.wish.id))},[e("img",{src:p.wish.img,alt:"",class:"card__image"},null,8,Pe),e("h3",De,C(p.wish.name),1),e("p",Ie,C(c(p.wish.price))+" руб ",1),e("div",Ae,[e("div",Se,[e("img",{src:s.userImg,alt:"User Avatar",class:"card__img user__info--avatarImg"},null,8,Me),e("span",{textContent:C(s.userName)},null,8,Re)]),e("span",Le,C(new Date().toLocaleDateString()),1)])],40,We))}},Fe=W(Ve,[["__scopeId","data-v-ca3addb0"]]),Ee={class:"form__wrapper"},je={class:"form__list"},ze={class:"form__preview__card"},Oe={class:"card__label card__label--file",for:"file-input"},qe=["src"],Te={card__title:""},Ge={class:"card__price"},He={class:"card__user__info"},Je={class:"user__info--info"},Ke=["src"],Qe=["textContent"],Xe={class:"user__info--date"},Ye={__name:"WiCardsAdd",props:{userImg:{type:String},userName:{type:String}},emits:["handleAddWish",{}],setup(p,{emit:s}){const t=p,f=s,c=S(),_=I(),l=n(""),o=n(""),i=n(""),v=n(""),r=n(new Date().toLocaleDateString()),g=n("");function y(w){return w?new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB",minimumFractionDigits:0}).format(w):""}function k(){o.value="",i.value="",v.value="",g.value="",l.value=""}function b(w,a,B,U,G,H){return{id:crypto.randomUUID(),userId:_.currentUser.uid,img:w||"https://media.istockphoto.com/id/1308342088/vector/surprise-gift-box-gift-box-with-red-ribbon-bow-flat-style-element-design-for-giveaway.jpg?s=612x612&w=0&k=20&c=FUOJS2CFbYIqm4R7zfyKUdeS-gMyc3bGlRr1rL7rjQ0=",name:a,hover:!1,description:B||"Описание отсутствует. ",price:U||0,date:G,link:H,reserve:""}}async function d(){const w=b(l.value,o.value,i.value,v.value,r.value,g.value);await ee(M(c,"wishes",w.id),w),f("handleAddWish",w),k()}function h(w){const a=w.target.files[0];if(a){const B=new FileReader;B.onload=U=>{l.value=U.target.result},B.readAsDataURL(a)}}return(w,a)=>{const B=A("font-awesome-icon");return u(),m("form",{method:"dialog",class:"form",onSubmit:d},[a[9]||(a[9]=e("h1",{class:"form__title"}," Добавить желание ",-1)),e("div",Ee,[e("ul",je,[e("li",null,[a[5]||(a[5]=e("label",{for:"name"},"Название:",-1)),N(e("input",{id:"name","onUpdate:modelValue":a[0]||(a[0]=U=>o.value=U),type:"text",required:""},null,512),[[P,o.value]])]),e("li",null,[a[6]||(a[6]=e("label",{for:"description"},"Описание",-1)),N(e("textarea",{id:"description","onUpdate:modelValue":a[1]||(a[1]=U=>i.value=U),type:"text"},null,512),[[P,i.value]])]),e("li",null,[a[7]||(a[7]=e("label",{for:"price"},"Цена",-1)),N(e("input",{id:"price","onUpdate:modelValue":a[2]||(a[2]=U=>v.value=U),type:"number"},null,512),[[P,v.value]])]),e("li",null,[a[8]||(a[8]=e("label",{for:"link"},"Ссылка на товар",-1)),N(e("input",{id:"link","onUpdate:modelValue":a[3]||(a[3]=U=>g.value=U),type:"text"},null,512),[[P,g.value]])])]),e("div",ze,[e("label",Oe,[l.value?(u(),m("img",{key:0,src:l.value,alt:"",class:"card__image"},null,8,qe)):$("",!0),l.value?$("",!0):(u(),L(B,{key:1,class:"card__icon--file",icon:["fas","file-image"]})),e("input",{id:"file-input",class:"card__input card__input--file",type:"file",onChange:a[4]||(a[4]=U=>h(U))},null,32)]),e("h3",Te,C(o.value),1),e("p",Ge,C(y(v.value)),1),e("div",He,[e("div",Je,[e("img",{src:t.userImg,alt:"User Avatar",class:"card__img user__info--avatarImg"},null,8,Ke),e("span",{textContent:C(t.userName)},null,8,Qe)]),e("span",Xe,C(r.value),1)])])]),a[10]||(a[10]=e("button",{class:"form__btn form__btn--add"}," добавить ",-1))],32)}}},Ze=W(Ye,[["__scopeId","data-v-93850d62"]]),eo={key:1,class:"wishes__list"},oo={class:"whishes__cards"},so={key:2,class:"wishes__empty"},ao={__name:"WiUserWishes",props:{user:{type:Object,default:()=>({})},hasEditPermission:{type:Boolean,default:()=>!1},currentUserUid:{type:String}},setup(p){const s=p,t=n(null),f=n([]);z(async()=>{console.log("UID пользователя:",s.currentUserUid);try{const{wishes:l}=await q(s.currentUserUid);f.value=l}catch(l){console.error("Ошибка при получении желаний:",l)}});function c(){t.value.openModal()}function _(l){f.value.push(l)}return(l,o)=>(u(),m(D,null,[o[1]||(o[1]=e("h2",null,"Список желаний",-1)),p.hasEditPermission?(u(),m("button",{key:0,class:"profile__button profile__button--addWish",onClick:c}," Добавить ")):$("",!0),x(T,{ref_key:"modalAddCard",ref:t},{default:O(()=>[x(Ze,{"user-img":s.user.photoUrl,"user-name":s.user.displayName,onHandleAddWish:_},null,8,["user-img","user-name"])]),_:1},512),f.value.length?(u(),m("section",eo,[e("div",oo,[(u(!0),m(D,null,R(f.value,i=>(u(),L(Fe,{key:i.id,wish:i,"user-img":s.user.photoUrl,"user-name":s.user.displayName},null,8,["wish","user-img","user-name"]))),128))])])):(u(),m("div",so,o[0]||(o[0]=[e("img",{src:Ne,alt:"empty-box",loading:"lazy"},null,-1),e("p",null,"У пользователя пока нет желаний.",-1)])))],64))}},to=W(ao,[["__scopeId","data-v-433bc53b"]]),ro={class:"user"},lo={class:"skeleton-loader user__info"},no={class:"user__info"},io={key:0,class:"profile"},uo={class:"profile__settings"},co={key:1,style:{height:"55px"}},po={class:"profile__name"},_o={class:"profile__about"},mo={class:"profile__badges"},fo={class:"wishes"},go={__name:"UserPageView",setup(p){const s=n({}),t=n([]),f=se(),c=n(null),_=n(!0),l=I(),o=n(!0),i=n("");function v(){c.value.openModal()}function r(g){s.value.displayName=g.userName,s.value.about=g.userAbout,t.value=g.pickedBadges,console.log("Профиль обновлен в родительском компоненте:",g)}return z(async()=>{_.value=!0;const g=f.params.uid,y=l.currentUser;i.value=y.uid,y&&y.uid===g&&(o.value=!0);const{user:k}=await q(g);k?(s.value=k,t.value=k.badges||[]):console.error("Не удалось загрузить данные пользователя"),_.value=!1}),(g,y)=>(u(),m("div",null,[e("div",null,[x(ae)]),e("main",ro,[N(e("div",lo,null,512),[[oe,_.value]]),e("section",no,[!_.value&&s.value&&s.value.displayName?(u(),m("div",io,[x(we,{user:s.value},null,8,["user"]),e("div",uo,[o.value?(u(),m("button",{key:0,class:"profile__button profile__button--edit",onClick:v}," Редактировать профиль ")):$("",!0),o.value?$("",!0):(u(),m("div",co)),x(T,{ref_key:"modal",ref:c},{default:O(()=>[x(xe,{user:s.value,"picked-badges":t.value,onUpdateProfile:r},null,8,["user","picked-badges"])]),_:1},512)]),e("h2",po,C(s.value.displayName),1),e("p",_o,C(s.value.about||"Информация о пользователе отсутствует"),1),e("div",mo,[(u(!0),m(D,null,R(t.value,(k,b)=>(u(),m("div",{key:b,class:"badge"},C(k.name),1))),128))])])):$("",!0)]),e("div",fo,[i.value&&s.value?(u(),L(to,{key:0,"current-user-uid":i.value,"has-edit-permission":o.value,user:s.value},null,8,["current-user-uid","has-edit-permission","user"])):$("",!0)])])]))}},wo=W(go,[["__scopeId","data-v-7781ec0c"]]);export{wo as default};
